---

title: A3C Datawise

keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/12_a3c.a3c_data.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/12_a3c.a3c_data.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="A3C-Model">A3C Model<a class="anchor-link" href="#A3C-Model"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="LinearA2C" class="doc_header"><code>class</code> <code>LinearA2C</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/a3c/a3c_data.py#L29" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>LinearA2C</code>(<strong><code>input_shape</code></strong>, <strong><code>n_actions</code></strong>) :: <code>Module</code></p>
</blockquote>
<p>Base class for all neural network modules.</p>
<p>Your models should also subclass this class.</p>
<p>Modules can also contain other Modules, allowing to nest them in
a tree structure. You can assign the submodules as regular attributes::</p>

<pre><code>import torch.nn as nn
import torch.nn.functional as F

class Model(nn.Module):
    def __init__(self):
        super(Model, self).__init__()
        self.conv1 = nn.Conv2d(1, 20, 5)
        self.conv2 = nn.Conv2d(20, 20, 5)

    def forward(self, x):
        x = F.relu(self.conv1(x))
        return F.relu(self.conv2(x))

</code></pre>
<p>Submodules assigned in this way will be registered, and will have their
parameters converted too when you call :meth:<code>to</code>, etc.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="A3C-Learner">A3C Learner<a class="anchor-link" href="#A3C-Learner"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">batch</span><span class="o">=</span><span class="p">[</span>
 <span class="n">Experience</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.0285</span><span class="p">,</span>  <span class="mf">0.1640</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0033</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3421</span><span class="p">]]),</span><span class="n">sp</span><span class="o">=</span><span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.0285</span><span class="p">,</span>  <span class="mf">0.1640</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0033</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3421</span><span class="p">]]),</span>
            <span class="n">a</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span><span class="n">r</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">]),</span><span class="n">d</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">])),</span>
 <span class="n">Experience</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.0252</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0311</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0101</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0504</span><span class="p">]]),</span><span class="n">sp</span><span class="o">=</span><span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.0252</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0311</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0101</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0504</span><span class="p">]]),</span>
            <span class="n">a</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span><span class="n">r</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">]),</span><span class="n">d</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">])),</span>
 <span class="n">Experience</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.0258</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2261</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0111</span><span class="p">,</span>  <span class="mf">0.2391</span><span class="p">]]),</span><span class="n">sp</span><span class="o">=</span><span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.0258</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2261</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0111</span><span class="p">,</span>  <span class="mf">0.2391</span><span class="p">]]),</span>
            <span class="n">a</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span><span class="n">r</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">]),</span><span class="n">d</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">])),</span>
 <span class="n">Experience</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.0517</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2260</span><span class="p">,</span>  <span class="mf">0.0195</span><span class="p">,</span>  <span class="mf">0.2377</span><span class="p">]]),</span><span class="n">sp</span><span class="o">=</span><span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.0517</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2260</span><span class="p">,</span>  <span class="mf">0.0195</span><span class="p">,</span>  <span class="mf">0.2377</span><span class="p">]]),</span>
            <span class="n">a</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span><span class="n">r</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">]),</span><span class="n">d</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">])),</span>
 <span class="n">Experience</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.0562</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4214</span><span class="p">,</span>  <span class="mf">0.0242</span><span class="p">,</span>  <span class="mf">0.5365</span><span class="p">]]),</span><span class="n">sp</span><span class="o">=</span><span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.0562</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4214</span><span class="p">,</span>  <span class="mf">0.0242</span><span class="p">,</span>  <span class="mf">0.5365</span><span class="p">]]),</span>
            <span class="n">a</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span><span class="n">r</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">]),</span><span class="n">d</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mf">0.</span><span class="p">])),</span>
 <span class="n">Experience</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.0647</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6169</span><span class="p">,</span>  <span class="mf">0.0349</span><span class="p">,</span>  <span class="mf">0.8367</span><span class="p">]]),</span><span class="n">sp</span><span class="o">=</span><span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.0647</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6169</span><span class="p">,</span>  <span class="mf">0.0349</span><span class="p">,</span>  <span class="mf">0.8367</span><span class="p">]]),</span>
            <span class="n">a</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span><span class="n">r</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">]),</span><span class="n">d</span><span class="o">=</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.</span><span class="p">]))</span>
<span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="r_estimate" class="doc_header"><code>r_estimate</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/a3c/a3c_data.py#L54" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>r_estimate</code>(<strong><code>s</code></strong>, <strong><code>r</code></strong>, <strong><code>d_mask</code></strong>, <strong><code>non_d_mask</code></strong>, <strong><code>model</code></strong>, <strong><code>val_gamma</code></strong>, <strong><code>device</code></strong>)</p>
</blockquote>
<p>Returns rewards <code>r</code> estimated direction by <code>model</code> from states <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="unbatch" class="doc_header"><code>unbatch</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/a3c/a3c_data.py#L64" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>unbatch</code>(<strong><code>batch</code></strong>, <strong><code>model</code></strong>, <strong><code>last_val_gamma</code></strong>, <strong><code>device</code></strong>=<em><code>'cpu'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">=</span><span class="n">LinearA2C</span><span class="p">((</span><span class="mi">4</span><span class="p">,),</span><span class="mi">2</span><span class="p">)</span>
<span class="n">unbatch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(tensor([[-0.0285,  0.1640, -0.0033, -0.3421],
         [-0.0252, -0.0311, -0.0101, -0.0504],
         [-0.0258, -0.2261, -0.0111,  0.2391],
         [-0.0517, -0.2260,  0.0195,  0.2377],
         [-0.0562, -0.4214,  0.0242,  0.5365],
         [-0.0647, -0.6169,  0.0349,  0.8367]]),
 tensor([1, 0, 0, 1, 0, 0]),
 tensor([[0.6711],
         [0.6646],
         [0.6353],
         [0.6375],
         [0.5671],
         [1.0000]]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="loss_func" class="doc_header"><code>loss_func</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/a3c/a3c_data.py#L85" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>loss_func</code>(<strong><code>pred</code></strong>, <strong><code>yb</code></strong>, <strong><code>learn</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="A3CLearner" class="doc_header"><code>class</code> <code>A3CLearner</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/a3c/a3c_data.py#L110" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>A3CLearner</code>(<strong><code>dls</code></strong>, <strong><code>agent</code></strong>:<a href="/fastrl/basic_agents.html#BaseAgent"><code>BaseAgent</code></a>=<em><code>BaseAgent(model=None)</code></em>, <strong><code>model</code></strong>=<em><code>None</code></em>, <strong><code>use_train_mets</code></strong>=<em><code>True</code></em>, <strong><code>loss_func</code></strong>=<em><code>None</code></em>, <strong><code>opt_func</code></strong>=<em><code>Adam</code></em>, <strong><code>lr</code></strong>=<em><code>0.001</code></em>, <strong><code>splitter</code></strong>=<em><code>trainable_params</code></em>, <strong><code>cbs</code></strong>=<em><code>None</code></em>, <strong><code>metrics</code></strong>=<em><code>None</code></em>, <strong><code>path</code></strong>=<em><code>None</code></em>, <strong><code>model_dir</code></strong>=<em><code>'models'</code></em>, <strong><code>wd</code></strong>=<em><code>None</code></em>, <strong><code>wd_bn_bias</code></strong>=<em><code>False</code></em>, <strong><code>train_bn</code></strong>=<em><code>True</code></em>, <strong><code>moms</code></strong>=<em><code>(0.95, 0.85, 0.95)</code></em>) :: <a href="/fastrl/basic_train.html#AgentLearner"><code>AgentLearner</code></a></p>
</blockquote>
<p>Group together a <code>model</code>, some <code>dls</code> and a <a href="/fastrl/a3c.a3c_data.html#loss_func"><code>loss_func</code></a> to handle training</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="A3CTrainer" class="doc_header"><code>class</code> <code>A3CTrainer</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/a3c/a3c_data.py#L126" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>A3CTrainer</code>(<strong><code>before_fit</code></strong>=<em><code>None</code></em>, <strong><code>before_epoch</code></strong>=<em><code>None</code></em>, <strong><code>before_train</code></strong>=<em><code>None</code></em>, <strong><code>before_batch</code></strong>=<em><code>None</code></em>, <strong><code>after_pred</code></strong>=<em><code>None</code></em>, <strong><code>after_loss</code></strong>=<em><code>None</code></em>, <strong><code>before_backward</code></strong>=<em><code>None</code></em>, <strong><code>after_backward</code></strong>=<em><code>None</code></em>, <strong><code>after_step</code></strong>=<em><code>None</code></em>, <strong><code>after_cancel_batch</code></strong>=<em><code>None</code></em>, <strong><code>after_batch</code></strong>=<em><code>None</code></em>, <strong><code>after_cancel_train</code></strong>=<em><code>None</code></em>, <strong><code>after_train</code></strong>=<em><code>None</code></em>, <strong><code>before_validate</code></strong>=<em><code>None</code></em>, <strong><code>after_cancel_validate</code></strong>=<em><code>None</code></em>, <strong><code>after_validate</code></strong>=<em><code>None</code></em>, <strong><code>after_cancel_epoch</code></strong>=<em><code>None</code></em>, <strong><code>after_epoch</code></strong>=<em><code>None</code></em>, <strong><code>after_cancel_fit</code></strong>=<em><code>None</code></em>, <strong><code>after_fit</code></strong>=<em><code>None</code></em>) :: <code>Callback</code></p>
</blockquote>
<p>Basic class handling tweaks of the training loop by changing a <code>Learner</code> in various events</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">data_fit</span><span class="p">(</span><span class="n">queue</span><span class="p">:</span><span class="n">mp</span><span class="o">.</span><span class="n">JoinableQueue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">items</span><span class="p">:</span><span class="n">L</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">agent</span><span class="p">:</span><span class="n">BaseAgent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">learner_cls</span><span class="p">:</span><span class="n">Learner</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">experience_block</span><span class="p">:</span><span class="n">ExperienceBlock</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">cancel</span><span class="p">:</span><span class="n">mp</span><span class="o">.</span><span class="n">Event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="c1">#     print(agent,flush=True)</span>
    <span class="n">blk</span><span class="o">=</span><span class="n">IterableDataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="p">(</span><span class="n">experience_block</span><span class="p">(</span><span class="n">agent</span><span class="o">=</span><span class="n">agent</span><span class="p">)),</span>
                          <span class="n">splitter</span><span class="o">=</span><span class="n">FuncSplitter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="kc">False</span><span class="p">))</span>
    <span class="n">dls</span><span class="o">=</span><span class="n">blk</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dls</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cancel</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
                <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AvgEpisodeRewardMetric" class="doc_header"><code>class</code> <code>AvgEpisodeRewardMetric</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/metrics.py#L28" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AvgEpisodeRewardMetric</code>() :: <code>Metric</code></p>
</blockquote>
<p>Blueprint for defining a metric</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">env</span><span class="o">=</span><span class="s1">&#39;CartPole-v1&#39;</span>
<span class="n">model</span><span class="o">=</span><span class="n">LinearA2C</span><span class="p">((</span><span class="mi">4</span><span class="p">,),</span><span class="mi">2</span><span class="p">)</span>

<span class="n">block</span><span class="o">=</span><span class="n">AsyncExperienceBlock</span><span class="p">(</span>
    <span class="n">experience_block</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">FirstLastExperienceBlock</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dls_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bs&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;n_steps&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;num_workers&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                                                                             <span class="s1">&#39;verbose&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;indexed&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;shuffle_train&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
                                                                             <span class="s1">&#39;batch_tfms&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span><span class="n">x</span><span class="p">)}),</span>
    <span class="n">n_processes</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">n</span><span class="o">=</span><span class="mi">128</span><span class="o">*</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">data_fit</span><span class="o">=</span><span class="n">data_fit</span><span class="p">,</span>
    <span class="n">agent</span><span class="o">=</span><span class="n">ActorCriticAgent</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">blk</span><span class="o">=</span><span class="n">IterableDataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="p">(</span><span class="n">block</span><span class="p">),</span>
                      <span class="n">splitter</span><span class="o">=</span><span class="n">FuncSplitter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="kc">False</span><span class="p">),</span>
                      <span class="n">batch_tfms</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span><span class="n">x</span><span class="p">),</span>
                     <span class="p">)</span>
<span class="n">dls</span><span class="o">=</span><span class="n">blk</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">([</span><span class="n">env</span><span class="p">]</span><span class="o">*</span><span class="mi">15</span><span class="p">,</span><span class="n">bs</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>

<span class="n">agent</span><span class="o">=</span><span class="n">ActorCriticAgent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
<span class="n">learner</span><span class="o">=</span><span class="n">A3CLearner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span><span class="n">agent</span><span class="o">=</span><span class="n">agent</span><span class="p">,</span><span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">A3CTrainer</span><span class="p">],</span><span class="n">reward_steps</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">AvgEpisodeRewardMetric</span><span class="p">()])</span>
<span class="n">learner</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span><span class="n">wd</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>train_avg_episode_r</th>
      <th>valid_loss</th>
      <th>valid_avg_episode_r</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.632946</td>
      <td>0.000000</td>
      <td>00:03</td>
    </tr>
  </tbody>
</table>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[Experience(d=tensor([True]), s=tensor([[-0.1011, -0.7521,  0.1781,  1.5704]], dtype=torch.float64), sp=tensor([[-0.1161, -0.5595,  0.2095,  1.3382]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([1]), eid=tensor([139791660164624]), episode_r=tensor([23.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[-0.1011, -0.7521,  0.1781,  1.5704]], dtype=torch.float64), sp=tensor([[-0.1161, -0.5595,  0.2095,  1.3382]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([1]), eid=tensor([139791660166288]), episode_r=tensor([23.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[-0.1011, -0.7521,  0.1781,  1.5704]], dtype=torch.float64), sp=tensor([[-0.1161, -0.5595,  0.2095,  1.3382]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([1]), eid=tensor([139791660166672]), episode_r=tensor([23.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[-0.1011, -0.7521,  0.1781,  1.5704]], dtype=torch.float64), sp=tensor([[-0.1161, -0.5595,  0.2095,  1.3382]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([1]), eid=tensor([139791660166544]), episode_r=tensor([23.], dtype=torch.float64), absolute_end=tensor([False]))]
[Experience(d=tensor([True]), s=tensor([[-0.1115,  0.0217,  0.2091,  0.5381]], dtype=torch.float64), sp=tensor([[-0.1110, -0.1757,  0.2198,  0.8887]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791385864016]), episode_r=tensor([41.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[-0.1115,  0.0217,  0.2091,  0.5381]], dtype=torch.float64), sp=tensor([[-0.1110, -0.1757,  0.2198,  0.8887]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791660316304]), episode_r=tensor([41.], dtype=torch.float64), absolute_end=tensor([False]))]
[Experience(d=tensor([True]), s=tensor([[-0.1115,  0.0217,  0.2091,  0.5381]], dtype=torch.float64), sp=tensor([[-0.1110, -0.1757,  0.2198,  0.8887]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791660318032]), episode_r=tensor([41.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[-0.1115,  0.0217,  0.2091,  0.5381]], dtype=torch.float64), sp=tensor([[-0.1110, -0.1757,  0.2198,  0.8887]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791663561424]), episode_r=tensor([41.], dtype=torch.float64), absolute_end=tensor([False]))]
[Experience(d=tensor([True]), s=tensor([[ 0.0588,  1.0415, -0.2009, -1.9444]], dtype=torch.float64), sp=tensor([[ 0.0797,  1.2382, -0.2398, -2.2921]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([1]), eid=tensor([139791387410256]), episode_r=tensor([36.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.0588,  1.0415, -0.2009, -1.9444]], dtype=torch.float64), sp=tensor([[ 0.0797,  1.2382, -0.2398, -2.2921]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([1]), eid=tensor([139791387410384]), episode_r=tensor([36.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.0588,  1.0415, -0.2009, -1.9444]], dtype=torch.float64), sp=tensor([[ 0.0797,  1.2382, -0.2398, -2.2921]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([1]), eid=tensor([139791660776592]), episode_r=tensor([36.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.0588,  1.0415, -0.2009, -1.9444]], dtype=torch.float64), sp=tensor([[ 0.0797,  1.2382, -0.2398, -2.2921]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([1]), eid=tensor([139791660774160]), episode_r=tensor([36.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.0877,  1.2248, -0.1770, -1.9667]], dtype=torch.float64), sp=tensor([[ 0.1122,  1.0319, -0.2163, -1.7337]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387517200]), episode_r=tensor([17.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.0877,  1.2248, -0.1770, -1.9667]], dtype=torch.float64), sp=tensor([[ 0.1122,  1.0319, -0.2163, -1.7337]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387517392]), episode_r=tensor([17.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.0877,  1.2248, -0.1770, -1.9667]], dtype=torch.float64), sp=tensor([[ 0.1122,  1.0319, -0.2163, -1.7337]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387509392]), episode_r=tensor([17.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.0877,  1.2248, -0.1770, -1.9667]], dtype=torch.float64), sp=tensor([[ 0.1122,  1.0319, -0.2163, -1.7337]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387497296]), episode_r=tensor([17.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.0925,  1.0286, -0.1825, -1.6505]], dtype=torch.float64), sp=tensor([[ 0.1131,  0.8361, -0.2155, -1.4198]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387517584]), episode_r=tensor([14.], dtype=torch.float64), absolute_end=tensor([False]))]
[Experience(d=tensor([True]), s=tensor([[ 0.0925,  1.0286, -0.1825, -1.6505]], dtype=torch.float64), sp=tensor([[ 0.1131,  0.8361, -0.2155, -1.4198]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387517776]), episode_r=tensor([14.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.0925,  1.0286, -0.1825, -1.6505]], dtype=torch.float64), sp=tensor([[ 0.1131,  0.8361, -0.2155, -1.4198]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387509776]), episode_r=tensor([14.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.0925,  1.0286, -0.1825, -1.6505]], dtype=torch.float64), sp=tensor([[ 0.1131,  0.8361, -0.2155, -1.4198]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387497680]), episode_r=tensor([14.], dtype=torch.float64), absolute_end=tensor([False]))]
[Experience(d=tensor([True]), s=tensor([[ 0.4583,  2.7187, -0.2076, -2.8525]], dtype=torch.float64), sp=tensor([[ 0.5127,  2.5255, -0.2647, -2.6295]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387517968]), episode_r=tensor([51.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.4583,  2.7187, -0.2076, -2.8525]], dtype=torch.float64), sp=tensor([[ 0.5127,  2.5255, -0.2647, -2.6295]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387518160]), episode_r=tensor([51.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.4583,  2.7187, -0.2076, -2.8525]], dtype=torch.float64), sp=tensor([[ 0.5127,  2.5255, -0.2647, -2.6295]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387510160]), episode_r=tensor([51.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.4583,  2.7187, -0.2076, -2.8525]], dtype=torch.float64), sp=tensor([[ 0.5127,  2.5255, -0.2647, -2.6295]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387498064]), episode_r=tensor([51.], dtype=torch.float64), absolute_end=tensor([False]))]
[Experience(d=tensor([True]), s=tensor([[ 0.0876,  1.2225, -0.1737, -1.9165]], dtype=torch.float64), sp=tensor([[ 0.1120,  1.0297, -0.2120, -1.6823]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387518352]), episode_r=tensor([17.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.0876,  1.2225, -0.1737, -1.9165]], dtype=torch.float64), sp=tensor([[ 0.1120,  1.0297, -0.2120, -1.6823]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387518544]), episode_r=tensor([17.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.0876,  1.2225, -0.1737, -1.9165]], dtype=torch.float64), sp=tensor([[ 0.1120,  1.0297, -0.2120, -1.6823]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387510544]), episode_r=tensor([17.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.0876,  1.2225, -0.1737, -1.9165]], dtype=torch.float64), sp=tensor([[ 0.1120,  1.0297, -0.2120, -1.6823]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387498448]), episode_r=tensor([17.], dtype=torch.float64), absolute_end=tensor([False]))]
[Experience(d=tensor([True]), s=tensor([[-0.2962, -0.7297,  0.1931,  1.0731]], dtype=torch.float64), sp=tensor([[-0.3108, -0.5375,  0.2146,  0.8467]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([1]), eid=tensor([139791387518736]), episode_r=tensor([45.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[-0.2962, -0.7297,  0.1931,  1.0731]], dtype=torch.float64), sp=tensor([[-0.3108, -0.5375,  0.2146,  0.8467]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([1]), eid=tensor([139791387518928]), episode_r=tensor([45.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[-0.2962, -0.7297,  0.1931,  1.0731]], dtype=torch.float64), sp=tensor([[-0.3108, -0.5375,  0.2146,  0.8467]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([1]), eid=tensor([139791387510928]), episode_r=tensor([45.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[-0.2962, -0.7297,  0.1931,  1.0731]], dtype=torch.float64), sp=tensor([[-0.3108, -0.5375,  0.2146,  0.8467]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([1]), eid=tensor([139791387498832]), episode_r=tensor([45.], dtype=torch.float64), absolute_end=tensor([False]))]
[Experience(d=tensor([True]), s=tensor([[ 0.1970,  1.9818, -0.1785, -2.6267]], dtype=torch.float64), sp=tensor([[ 0.2366,  1.7884, -0.2310, -2.3934]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387519120]), episode_r=tensor([41.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.1970,  1.9818, -0.1785, -2.6267]], dtype=torch.float64), sp=tensor([[ 0.2366,  1.7884, -0.2310, -2.3934]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387519312]), episode_r=tensor([41.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.1970,  1.9818, -0.1785, -2.6267]], dtype=torch.float64), sp=tensor([[ 0.2366,  1.7884, -0.2310, -2.3934]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387511312]), episode_r=tensor([41.], dtype=torch.float64), absolute_end=tensor([False])), Experience(d=tensor([True]), s=tensor([[ 0.1970,  1.9818, -0.1785, -2.6267]], dtype=torch.float64), sp=tensor([[ 0.2366,  1.7884, -0.2310, -2.3934]], dtype=torch.float64), r=tensor([1.], dtype=torch.float64), a=tensor([0]), eid=tensor([139791387499216]), episode_r=tensor([41.], dtype=torch.float64), absolute_end=tensor([False]))]
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Process DataFitProcess-86:
Process DataFitProcess-88:
Process DataFitProcess-87:
Traceback (most recent call last):
Traceback (most recent call last):
  File &#34;/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/process.py&#34;, line 297, in _bootstrap
    self.run()
  File &#34;/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/process.py&#34;, line 297, in _bootstrap
    self.run()
Traceback (most recent call last):
  File &#34;/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/process.py&#34;, line 99, in run
    self._target(*self._args, **self._kwargs)
  File &#34;/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/process.py&#34;, line 99, in run
    self._target(*self._args, **self._kwargs)
  File &#34;/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/process.py&#34;, line 297, in _bootstrap
    self.run()
  File &#34;&lt;ipython-input-10-47dbcd3e37a2&gt;&#34;, line 9, in data_fit
    queue.put(x)
  File &#34;&lt;ipython-input-10-47dbcd3e37a2&gt;&#34;, line 9, in data_fit
    queue.put(x)
Process DataFitProcess-85:
Traceback (most recent call last):
  File &#34;/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/queues.py&#34;, line 302, in put
    if not self._sem.acquire(block, timeout):
  File &#34;/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/process.py&#34;, line 297, in _bootstrap
    self.run()
  File &#34;/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/process.py&#34;, line 99, in run
    self._target(*self._args, **self._kwargs)
  File &#34;&lt;ipython-input-10-47dbcd3e37a2&gt;&#34;, line 9, in data_fit
    queue.put(x)
KeyboardInterrupt
  File &#34;/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/queues.py&#34;, line 302, in put
    if not self._sem.acquire(block, timeout):
KeyboardInterrupt
  File &#34;/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/queues.py&#34;, line 302, in put
    if not self._sem.acquire(block, timeout):
  File &#34;/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/process.py&#34;, line 99, in run
    self._target(*self._args, **self._kwargs)
KeyboardInterrupt
  File &#34;&lt;ipython-input-10-47dbcd3e37a2&gt;&#34;, line 9, in data_fit
    queue.put(x)
  File &#34;/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/queues.py&#34;, line 302, in put
    if not self._sem.acquire(block, timeout):
KeyboardInterrupt
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-19-4c2ff155f05a&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     19</span> agent<span class="ansi-blue-fg">=</span>ActorCriticAgent<span class="ansi-blue-fg">(</span>model<span class="ansi-blue-fg">=</span>model<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     20</span> learner<span class="ansi-blue-fg">=</span>A3CLearner<span class="ansi-blue-fg">(</span>dls<span class="ansi-blue-fg">,</span>agent<span class="ansi-blue-fg">=</span>agent<span class="ansi-blue-fg">,</span>cbs<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">[</span>A3CTrainer<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span>reward_steps<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">4</span><span class="ansi-blue-fg">,</span>metrics<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">[</span>AvgEpisodeRewardMetric<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 21</span><span class="ansi-red-fg"> </span>learner<span class="ansi-blue-fg">.</span>fit<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">50</span><span class="ansi-blue-fg">,</span>lr<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0.001</span><span class="ansi-blue-fg">,</span>wd<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastcore/utils.py</span> in <span class="ansi-cyan-fg">_f</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    452</span>         init_args<span class="ansi-blue-fg">.</span>update<span class="ansi-blue-fg">(</span>log<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    453</span>         setattr<span class="ansi-blue-fg">(</span>inst<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;init_args&#39;</span><span class="ansi-blue-fg">,</span> init_args<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 454</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> inst <span class="ansi-green-fg">if</span> to_return <span class="ansi-green-fg">else</span> f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    455</span>     <span class="ansi-green-fg">return</span> _f
<span class="ansi-green-intense-fg ansi-bold">    456</span> 

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastai/learner.py</span> in <span class="ansi-cyan-fg">fit</span><span class="ansi-blue-fg">(self, n_epoch, lr, wd, cbs, reset_opt)</span>
<span class="ansi-green-intense-fg ansi-bold">    202</span>             self<span class="ansi-blue-fg">.</span>opt<span class="ansi-blue-fg">.</span>set_hypers<span class="ansi-blue-fg">(</span>lr<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>lr <span class="ansi-green-fg">if</span> lr <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span> <span class="ansi-green-fg">else</span> lr<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    203</span>             self<span class="ansi-blue-fg">.</span>n_epoch<span class="ansi-blue-fg">,</span>self<span class="ansi-blue-fg">.</span>loss <span class="ansi-blue-fg">=</span> n_epoch<span class="ansi-blue-fg">,</span>tensor<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">0.</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 204</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>_with_events<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_do_fit<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;fit&#39;</span><span class="ansi-blue-fg">,</span> CancelFitException<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>_end_cleanup<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    205</span> 
<span class="ansi-green-intense-fg ansi-bold">    206</span>     <span class="ansi-green-fg">def</span> _end_cleanup<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> self<span class="ansi-blue-fg">.</span>dl<span class="ansi-blue-fg">,</span>self<span class="ansi-blue-fg">.</span>xb<span class="ansi-blue-fg">,</span>self<span class="ansi-blue-fg">.</span>yb<span class="ansi-blue-fg">,</span>self<span class="ansi-blue-fg">.</span>pred<span class="ansi-blue-fg">,</span>self<span class="ansi-blue-fg">.</span>loss <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">(</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">(</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span><span class="ansi-green-fg">None</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastai/learner.py</span> in <span class="ansi-cyan-fg">_with_events</span><span class="ansi-blue-fg">(self, f, event_type, ex, final)</span>
<span class="ansi-green-intense-fg ansi-bold">    153</span> 
<span class="ansi-green-intense-fg ansi-bold">    154</span>     <span class="ansi-green-fg">def</span> _with_events<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> f<span class="ansi-blue-fg">,</span> event_type<span class="ansi-blue-fg">,</span> ex<span class="ansi-blue-fg">,</span> final<span class="ansi-blue-fg">=</span>noop<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 155</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>       self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#39;before_{event_type}&#39;</span><span class="ansi-blue-fg">)</span>       <span class="ansi-blue-fg">;</span>f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    156</span>         <span class="ansi-green-fg">except</span> ex<span class="ansi-blue-fg">:</span> self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#39;after_cancel_{event_type}&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    157</span>         <span class="ansi-green-fg">finally</span><span class="ansi-blue-fg">:</span>   self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#39;after_{event_type}&#39;</span><span class="ansi-blue-fg">)</span>        <span class="ansi-blue-fg">;</span>final<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastai/learner.py</span> in <span class="ansi-cyan-fg">_do_fit</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    192</span>         <span class="ansi-green-fg">for</span> epoch <span class="ansi-green-fg">in</span> range<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>n_epoch<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    193</span>             self<span class="ansi-blue-fg">.</span>epoch<span class="ansi-blue-fg">=</span>epoch
<span class="ansi-green-fg">--&gt; 194</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>_with_events<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_do_epoch<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;epoch&#39;</span><span class="ansi-blue-fg">,</span> CancelEpochException<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    195</span> 
<span class="ansi-green-intense-fg ansi-bold">    196</span>     <span class="ansi-blue-fg">@</span>log_args<span class="ansi-blue-fg">(</span>but<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;cbs&#39;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastai/learner.py</span> in <span class="ansi-cyan-fg">_with_events</span><span class="ansi-blue-fg">(self, f, event_type, ex, final)</span>
<span class="ansi-green-intense-fg ansi-bold">    153</span> 
<span class="ansi-green-intense-fg ansi-bold">    154</span>     <span class="ansi-green-fg">def</span> _with_events<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> f<span class="ansi-blue-fg">,</span> event_type<span class="ansi-blue-fg">,</span> ex<span class="ansi-blue-fg">,</span> final<span class="ansi-blue-fg">=</span>noop<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 155</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>       self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#39;before_{event_type}&#39;</span><span class="ansi-blue-fg">)</span>       <span class="ansi-blue-fg">;</span>f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    156</span>         <span class="ansi-green-fg">except</span> ex<span class="ansi-blue-fg">:</span> self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#39;after_cancel_{event_type}&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    157</span>         <span class="ansi-green-fg">finally</span><span class="ansi-blue-fg">:</span>   self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#39;after_{event_type}&#39;</span><span class="ansi-blue-fg">)</span>        <span class="ansi-blue-fg">;</span>final<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastai/learner.py</span> in <span class="ansi-cyan-fg">_do_epoch</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    186</span> 
<span class="ansi-green-intense-fg ansi-bold">    187</span>     <span class="ansi-green-fg">def</span> _do_epoch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 188</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>_do_epoch_train<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    189</span>         self<span class="ansi-blue-fg">.</span>_do_epoch_validate<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    190</span> 

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastai/learner.py</span> in <span class="ansi-cyan-fg">_do_epoch_train</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    178</span>     <span class="ansi-green-fg">def</span> _do_epoch_train<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    179</span>         self<span class="ansi-blue-fg">.</span>dl <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>dls<span class="ansi-blue-fg">.</span>train
<span class="ansi-green-fg">--&gt; 180</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>_with_events<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>all_batches<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;train&#39;</span><span class="ansi-blue-fg">,</span> CancelTrainException<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    181</span> 
<span class="ansi-green-intense-fg ansi-bold">    182</span>     <span class="ansi-green-fg">def</span> _do_epoch_validate<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> ds_idx<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span> dl<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastai/learner.py</span> in <span class="ansi-cyan-fg">_with_events</span><span class="ansi-blue-fg">(self, f, event_type, ex, final)</span>
<span class="ansi-green-intense-fg ansi-bold">    153</span> 
<span class="ansi-green-intense-fg ansi-bold">    154</span>     <span class="ansi-green-fg">def</span> _with_events<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> f<span class="ansi-blue-fg">,</span> event_type<span class="ansi-blue-fg">,</span> ex<span class="ansi-blue-fg">,</span> final<span class="ansi-blue-fg">=</span>noop<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 155</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>       self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#39;before_{event_type}&#39;</span><span class="ansi-blue-fg">)</span>       <span class="ansi-blue-fg">;</span>f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    156</span>         <span class="ansi-green-fg">except</span> ex<span class="ansi-blue-fg">:</span> self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#39;after_cancel_{event_type}&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    157</span>         <span class="ansi-green-fg">finally</span><span class="ansi-blue-fg">:</span>   self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#39;after_{event_type}&#39;</span><span class="ansi-blue-fg">)</span>        <span class="ansi-blue-fg">;</span>final<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastai/learner.py</span> in <span class="ansi-cyan-fg">all_batches</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    159</span>     <span class="ansi-green-fg">def</span> all_batches<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    160</span>         self<span class="ansi-blue-fg">.</span>n_iter <span class="ansi-blue-fg">=</span> len<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>dl<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 161</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">for</span> o <span class="ansi-green-fg">in</span> enumerate<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>dl<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> self<span class="ansi-blue-fg">.</span>one_batch<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>o<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    162</span> 
<span class="ansi-green-intense-fg ansi-bold">    163</span>     <span class="ansi-green-fg">def</span> _do_one_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastai/data/load.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">     96</span>         self<span class="ansi-blue-fg">.</span>randomize<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     97</span>         self<span class="ansi-blue-fg">.</span>before_iter<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 98</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">for</span> b <span class="ansi-green-fg">in</span> _loaders<span class="ansi-blue-fg">[</span>self<span class="ansi-blue-fg">.</span>fake_l<span class="ansi-blue-fg">.</span>num_workers<span class="ansi-blue-fg">==</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>fake_l<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     99</span>             <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>device <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> b <span class="ansi-blue-fg">=</span> to_device<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>device<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    100</span>             <span class="ansi-green-fg">yield</span> self<span class="ansi-blue-fg">.</span>after_batch<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">__next__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    361</span> 
<span class="ansi-green-intense-fg ansi-bold">    362</span>     <span class="ansi-green-fg">def</span> __next__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 363</span><span class="ansi-red-fg">         </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_next_data<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    364</span>         self<span class="ansi-blue-fg">.</span>_num_yielded <span class="ansi-blue-fg">+=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-intense-fg ansi-bold">    365</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_dataset_kind <span class="ansi-blue-fg">==</span> _DatasetKind<span class="ansi-blue-fg">.</span>Iterable <span class="ansi-green-fg">and</span><span class="ansi-red-fg"> </span><span class="ansi-red-fg">\</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">_next_data</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    401</span>     <span class="ansi-green-fg">def</span> _next_data<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    402</span>         index <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_next_index<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># may raise StopIteration</span>
<span class="ansi-green-fg">--&gt; 403</span><span class="ansi-red-fg">         </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_dataset_fetcher<span class="ansi-blue-fg">.</span>fetch<span class="ansi-blue-fg">(</span>index<span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># may raise StopIteration</span>
<span class="ansi-green-intense-fg ansi-bold">    404</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_pin_memory<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    405</span>             data <span class="ansi-blue-fg">=</span> _utils<span class="ansi-blue-fg">.</span>pin_memory<span class="ansi-blue-fg">.</span>pin_memory<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/torch/utils/data/_utils/fetch.py</span> in <span class="ansi-cyan-fg">fetch</span><span class="ansi-blue-fg">(self, possibly_batched_index)</span>
<span class="ansi-green-intense-fg ansi-bold">     32</span>                 <span class="ansi-green-fg">raise</span> StopIteration
<span class="ansi-green-intense-fg ansi-bold">     33</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 34</span><span class="ansi-red-fg">             </span>data <span class="ansi-blue-fg">=</span> next<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>dataset_iter<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     35</span>         <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>collate_fn<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     36</span> 

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastai/data/load.py</span> in <span class="ansi-cyan-fg">create_batches</span><span class="ansi-blue-fg">(self, samps)</span>
<span class="ansi-green-intense-fg ansi-bold">    105</span>         self<span class="ansi-blue-fg">.</span>it <span class="ansi-blue-fg">=</span> iter<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>dataset<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>dataset <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span> <span class="ansi-green-fg">else</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">    106</span>         res <span class="ansi-blue-fg">=</span> filter<span class="ansi-blue-fg">(</span><span class="ansi-green-fg">lambda</span> o<span class="ansi-blue-fg">:</span>o <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> map<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>do_item<span class="ansi-blue-fg">,</span> samps<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 107</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">yield</span> <span class="ansi-green-fg">from</span> map<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>do_batch<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>chunkify<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    108</span> 
<span class="ansi-green-intense-fg ansi-bold">    109</span>     <span class="ansi-green-fg">def</span> new<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> dataset<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> cls<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastcore/utils.py</span> in <span class="ansi-cyan-fg">chunked</span><span class="ansi-blue-fg">(it, chunk_sz, drop_last, n_chunks)</span>
<span class="ansi-green-intense-fg ansi-bold">    351</span>     <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> isinstance<span class="ansi-blue-fg">(</span>it<span class="ansi-blue-fg">,</span> Iterator<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> it <span class="ansi-blue-fg">=</span> iter<span class="ansi-blue-fg">(</span>it<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    352</span>     <span class="ansi-green-fg">while</span> <span class="ansi-green-fg">True</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 353</span><span class="ansi-red-fg">         </span>res <span class="ansi-blue-fg">=</span> list<span class="ansi-blue-fg">(</span>itertools<span class="ansi-blue-fg">.</span>islice<span class="ansi-blue-fg">(</span>it<span class="ansi-blue-fg">,</span> chunk_sz<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    354</span>         <span class="ansi-green-fg">if</span> res <span class="ansi-green-fg">and</span> <span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">==</span>chunk_sz <span class="ansi-green-fg">or</span> <span class="ansi-green-fg">not</span> drop_last<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">yield</span> res
<span class="ansi-green-intense-fg ansi-bold">    355</span>         <span class="ansi-green-fg">if</span> len<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">&lt;</span>chunk_sz<span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastai/data/load.py</span> in <span class="ansi-cyan-fg">do_item</span><span class="ansi-blue-fg">(self, s)</span>
<span class="ansi-green-intense-fg ansi-bold">    118</span>     <span class="ansi-green-fg">def</span> prebatched<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>bs <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">    119</span>     <span class="ansi-green-fg">def</span> do_item<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> s<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 120</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>after_item<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>create_item<span class="ansi-blue-fg">(</span>s<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    121</span>         <span class="ansi-green-fg">except</span> SkipItemException<span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">    122</span>     <span class="ansi-green-fg">def</span> chunkify<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> b <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>prebatched <span class="ansi-green-fg">else</span> chunked<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>bs<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>drop_last<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/project/fastrl/fastrl/data.py</span> in <span class="ansi-cyan-fg">create_item</span><span class="ansi-blue-fg">(self, b)</span>
<span class="ansi-green-intense-fg ansi-bold">     25</span>     <span class="ansi-green-fg">def</span> create_item<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     26</span> <span class="ansi-red-fg">#         print(&#39;Before create_item: &#39;,b,self.prebatched)</span>
<span class="ansi-green-fg">---&gt; 27</span><span class="ansi-red-fg">         </span>b<span class="ansi-blue-fg">=</span> super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>create_item<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     28</span> <span class="ansi-red-fg">#         print(&#39;After create_item: &#39;,b)</span>
<span class="ansi-green-intense-fg ansi-bold">     29</span>         <span class="ansi-green-fg">if</span> type<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">==</span>tuple <span class="ansi-green-fg">and</span> len<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">==</span><span class="ansi-cyan-fg">1</span> <span class="ansi-green-fg">and</span> type<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">==</span>tuple<span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> b<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastai/data/load.py</span> in <span class="ansi-cyan-fg">create_item</span><span class="ansi-blue-fg">(self, s)</span>
<span class="ansi-green-intense-fg ansi-bold">    124</span>     <span class="ansi-green-fg">def</span> randomize<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> self<span class="ansi-blue-fg">.</span>rng <span class="ansi-blue-fg">=</span> random<span class="ansi-blue-fg">.</span>Random<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>rng<span class="ansi-blue-fg">.</span>randint<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">**</span><span class="ansi-cyan-fg">32</span><span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    125</span>     <span class="ansi-green-fg">def</span> retain<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> res<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>  <span class="ansi-green-fg">return</span> retain_types<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span> <span class="ansi-green-fg">if</span> is_listy<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">else</span> b<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 126</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">def</span> create_item<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> s<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>  <span class="ansi-green-fg">return</span> next<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>it<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> s <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span> <span class="ansi-green-fg">else</span> self<span class="ansi-blue-fg">.</span>dataset<span class="ansi-blue-fg">[</span>s<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    127</span>     <span class="ansi-green-fg">def</span> create_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> <span class="ansi-blue-fg">(</span>fa_collate<span class="ansi-blue-fg">,</span>fa_convert<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span>self<span class="ansi-blue-fg">.</span>prebatched<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    128</span>     <span class="ansi-green-fg">def</span> do_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>retain<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>create_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>before_batch<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastai/data/core.py</span> in <span class="ansi-cyan-fg">__getitem__</span><span class="ansi-blue-fg">(self, it)</span>
<span class="ansi-green-intense-fg ansi-bold">    291</span> 
<span class="ansi-green-intense-fg ansi-bold">    292</span>     <span class="ansi-green-fg">def</span> __getitem__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> it<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 293</span><span class="ansi-red-fg">         </span>res <span class="ansi-blue-fg">=</span> tuple<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>tl<span class="ansi-blue-fg">[</span>it<span class="ansi-blue-fg">]</span> <span class="ansi-green-fg">for</span> tl <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>tls<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    294</span>         <span class="ansi-green-fg">return</span> res <span class="ansi-green-fg">if</span> is_indexer<span class="ansi-blue-fg">(</span>it<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">else</span> list<span class="ansi-blue-fg">(</span>zip<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>res<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    295</span> 

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastai/data/core.py</span> in <span class="ansi-cyan-fg">&lt;listcomp&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-intense-fg ansi-bold">    291</span> 
<span class="ansi-green-intense-fg ansi-bold">    292</span>     <span class="ansi-green-fg">def</span> __getitem__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> it<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 293</span><span class="ansi-red-fg">         </span>res <span class="ansi-blue-fg">=</span> tuple<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>tl<span class="ansi-blue-fg">[</span>it<span class="ansi-blue-fg">]</span> <span class="ansi-green-fg">for</span> tl <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>tls<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    294</span>         <span class="ansi-green-fg">return</span> res <span class="ansi-green-fg">if</span> is_indexer<span class="ansi-blue-fg">(</span>it<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">else</span> list<span class="ansi-blue-fg">(</span>zip<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>res<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    295</span> 

<span class="ansi-green-fg">/opt/project/fastrl/fastrl/data.py</span> in <span class="ansi-cyan-fg">__getitem__</span><span class="ansi-blue-fg">(self, idx)</span>
<span class="ansi-green-intense-fg ansi-bold">     75</span>             <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>res_buffer<span class="ansi-blue-fg">.</span>popleft<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     76</span> 
<span class="ansi-green-fg">---&gt; 77</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>res<span class="ansi-blue-fg">=</span>super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>__getitem__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>source_idx <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>cycle_srcs <span class="ansi-green-fg">else</span> idx<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     78</span>         <span class="ansi-green-fg">except</span> <span class="ansi-blue-fg">(</span>IndexError<span class="ansi-blue-fg">,</span>SourceExhausted<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     79</span>             <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> self<span class="ansi-blue-fg">.</span>cycle_srcs<span class="ansi-blue-fg">:</span><span class="ansi-green-fg">raise</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastai/data/core.py</span> in <span class="ansi-cyan-fg">__getitem__</span><span class="ansi-blue-fg">(self, idx)</span>
<span class="ansi-green-intense-fg ansi-bold">    268</span>         res <span class="ansi-blue-fg">=</span> super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>__getitem__<span class="ansi-blue-fg">(</span>idx<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    269</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_after_item <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> res
<span class="ansi-green-fg">--&gt; 270</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_after_item<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> is_indexer<span class="ansi-blue-fg">(</span>idx<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">else</span> res<span class="ansi-blue-fg">.</span>map<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_after_item<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    271</span> 
<span class="ansi-green-intense-fg ansi-bold">    272</span> <span class="ansi-red-fg"># Cell</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastai/data/core.py</span> in <span class="ansi-cyan-fg">_after_item</span><span class="ansi-blue-fg">(self, o)</span>
<span class="ansi-green-intense-fg ansi-bold">    230</span>         <span class="ansi-green-fg">return</span> super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>_new<span class="ansi-blue-fg">(</span>items<span class="ansi-blue-fg">,</span> tfms<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>tfms<span class="ansi-blue-fg">,</span> do_setup<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">,</span> types<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>types<span class="ansi-blue-fg">,</span> split_idx<span class="ansi-blue-fg">=</span>split_idx<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    231</span>     <span class="ansi-green-fg">def</span> subset<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> i<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_new<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_get<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>splits<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> split_idx<span class="ansi-blue-fg">=</span>i<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 232</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">def</span> _after_item<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> o<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>tfms<span class="ansi-blue-fg">(</span>o<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    233</span>     <span class="ansi-green-fg">def</span> __repr__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> <span class="ansi-blue-fg">f&#34;{self.__class__.__name__}: {self.items}\ntfms - {self.tfms.fs}&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    234</span>     <span class="ansi-green-fg">def</span> __iter__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> <span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span> <span class="ansi-green-fg">for</span> i <span class="ansi-green-fg">in</span> range<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastcore/transform.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, o)</span>
<span class="ansi-green-intense-fg ansi-bold">    201</span>         self<span class="ansi-blue-fg">.</span>fs<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>t<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    202</span> 
<span class="ansi-green-fg">--&gt; 203</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">def</span> __call__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> o<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> compose_tfms<span class="ansi-blue-fg">(</span>o<span class="ansi-blue-fg">,</span> tfms<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>fs<span class="ansi-blue-fg">,</span> split_idx<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>split_idx<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    204</span>     <span class="ansi-green-fg">def</span> __repr__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> <span class="ansi-blue-fg">f&#34;Pipeline: {&#39; -&gt; &#39;.join([f.name for f in self.fs if f.name != &#39;noop&#39;])}&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    205</span>     <span class="ansi-green-fg">def</span> __getitem__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>i<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>fs<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastcore/transform.py</span> in <span class="ansi-cyan-fg">compose_tfms</span><span class="ansi-blue-fg">(x, tfms, is_enc, reverse, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    153</span>     <span class="ansi-green-fg">for</span> f <span class="ansi-green-fg">in</span> tfms<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    154</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> is_enc<span class="ansi-blue-fg">:</span> f <span class="ansi-blue-fg">=</span> f<span class="ansi-blue-fg">.</span>decode
<span class="ansi-green-fg">--&gt; 155</span><span class="ansi-red-fg">         </span>x <span class="ansi-blue-fg">=</span> f<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    156</span>     <span class="ansi-green-fg">return</span> x
<span class="ansi-green-intense-fg ansi-bold">    157</span> 

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastcore/transform.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, x, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     70</span>     <span class="ansi-blue-fg">@</span>property
<span class="ansi-green-intense-fg ansi-bold">     71</span>     <span class="ansi-green-fg">def</span> name<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> getattr<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;_name&#39;</span><span class="ansi-blue-fg">,</span> _get_name<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 72</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">def</span> __call__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_call<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;encodes&#39;</span><span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     73</span>     <span class="ansi-green-fg">def</span> decode  <span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_call<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;decodes&#39;</span><span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     74</span>     <span class="ansi-green-fg">def</span> __repr__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> <span class="ansi-blue-fg">f&#39;{self.name}:\nencodes: {self.encodes}decodes: {self.decodes}&#39;</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastcore/transform.py</span> in <span class="ansi-cyan-fg">_call</span><span class="ansi-blue-fg">(self, fn, x, split_idx, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     80</span>     <span class="ansi-green-fg">def</span> _call<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> fn<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> split_idx<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     81</span>         <span class="ansi-green-fg">if</span> split_idx<span class="ansi-blue-fg">!=</span>self<span class="ansi-blue-fg">.</span>split_idx <span class="ansi-green-fg">and</span> self<span class="ansi-blue-fg">.</span>split_idx <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> x
<span class="ansi-green-fg">---&gt; 82</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_do_call<span class="ansi-blue-fg">(</span>getattr<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> fn<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     83</span> 
<span class="ansi-green-intense-fg ansi-bold">     84</span>     <span class="ansi-green-fg">def</span> _do_call<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> f<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastcore/transform.py</span> in <span class="ansi-cyan-fg">_do_call</span><span class="ansi-blue-fg">(self, f, x, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     86</span>             <span class="ansi-green-fg">if</span> f <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> x
<span class="ansi-green-intense-fg ansi-bold">     87</span>             ret <span class="ansi-blue-fg">=</span> f<span class="ansi-blue-fg">.</span>returns_none<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> hasattr<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">&#39;returns_none&#39;</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">else</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-fg">---&gt; 88</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> retain_type<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">,</span> ret<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     89</span>         res <span class="ansi-blue-fg">=</span> tuple<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_do_call<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> x_<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> x_ <span class="ansi-green-fg">in</span> x<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     90</span>         <span class="ansi-green-fg">return</span> retain_type<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/fastcore/dispatch.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     97</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> f<span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> args<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     98</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>inst <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> f <span class="ansi-blue-fg">=</span> MethodType<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>inst<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 99</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    100</span> 
<span class="ansi-green-intense-fg ansi-bold">    101</span>     <span class="ansi-green-fg">def</span> __get__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> inst<span class="ansi-blue-fg">,</span> owner<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/opt/project/fastrl/fastrl/async_data.py</span> in <span class="ansi-cyan-fg">encodes</span><span class="ansi-blue-fg">(self, o)</span>
<span class="ansi-green-intense-fg ansi-bold">     76</span> 
<span class="ansi-green-intense-fg ansi-bold">     77</span>     <span class="ansi-green-fg">def</span> encodes<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>o<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 78</span><span class="ansi-red-fg">         </span>s<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>queue<span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     79</span> <span class="ansi-red-fg">#         print(s[0])</span>
<span class="ansi-green-intense-fg ansi-bold">     80</span>         <span class="ansi-green-fg">return</span> s

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/queues.py</span> in <span class="ansi-cyan-fg">get</span><span class="ansi-blue-fg">(self, block, timeout)</span>
<span class="ansi-green-intense-fg ansi-bold">    111</span>                 self<span class="ansi-blue-fg">.</span>_rlock<span class="ansi-blue-fg">.</span>release<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    112</span>         <span class="ansi-red-fg"># unserialize the data after having released the lock</span>
<span class="ansi-green-fg">--&gt; 113</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> _ForkingPickler<span class="ansi-blue-fg">.</span>loads<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    114</span> 
<span class="ansi-green-intense-fg ansi-bold">    115</span>     <span class="ansi-green-fg">def</span> qsize<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/site-packages/torch/multiprocessing/reductions.py</span> in <span class="ansi-cyan-fg">rebuild_storage_fd</span><span class="ansi-blue-fg">(cls, df, size)</span>
<span class="ansi-green-intense-fg ansi-bold">    280</span> 
<span class="ansi-green-intense-fg ansi-bold">    281</span> <span class="ansi-green-fg">def</span> rebuild_storage_fd<span class="ansi-blue-fg">(</span>cls<span class="ansi-blue-fg">,</span> df<span class="ansi-blue-fg">,</span> size<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 282</span><span class="ansi-red-fg">     </span>fd <span class="ansi-blue-fg">=</span> df<span class="ansi-blue-fg">.</span>detach<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    283</span>     <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    284</span>         storage <span class="ansi-blue-fg">=</span> storage_from_cache<span class="ansi-blue-fg">(</span>cls<span class="ansi-blue-fg">,</span> fd_id<span class="ansi-blue-fg">(</span>fd<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/resource_sharer.py</span> in <span class="ansi-cyan-fg">detach</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">     55</span>         <span class="ansi-green-fg">def</span> detach<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     56</span>             <span class="ansi-blue-fg">&#39;&#39;&#39;Get the fd.  This should only be called once.&#39;&#39;&#39;</span>
<span class="ansi-green-fg">---&gt; 57</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">with</span> _resource_sharer<span class="ansi-blue-fg">.</span>get_connection<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_id<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> conn<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     58</span>                 <span class="ansi-green-fg">return</span> reduction<span class="ansi-blue-fg">.</span>recv_handle<span class="ansi-blue-fg">(</span>conn<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     59</span> 

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/resource_sharer.py</span> in <span class="ansi-cyan-fg">get_connection</span><span class="ansi-blue-fg">(ident)</span>
<span class="ansi-green-intense-fg ansi-bold">     85</span>         <span class="ansi-green-fg">from</span> <span class="ansi-blue-fg">.</span>connection <span class="ansi-green-fg">import</span> Client
<span class="ansi-green-intense-fg ansi-bold">     86</span>         address<span class="ansi-blue-fg">,</span> key <span class="ansi-blue-fg">=</span> ident
<span class="ansi-green-fg">---&gt; 87</span><span class="ansi-red-fg">         </span>c <span class="ansi-blue-fg">=</span> Client<span class="ansi-blue-fg">(</span>address<span class="ansi-blue-fg">,</span> authkey<span class="ansi-blue-fg">=</span>process<span class="ansi-blue-fg">.</span>current_process<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>authkey<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     88</span>         c<span class="ansi-blue-fg">.</span>send<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">,</span> os<span class="ansi-blue-fg">.</span>getpid<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     89</span>         <span class="ansi-green-fg">return</span> c

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/connection.py</span> in <span class="ansi-cyan-fg">Client</span><span class="ansi-blue-fg">(address, family, authkey)</span>
<span class="ansi-green-intense-fg ansi-bold">    490</span>         c <span class="ansi-blue-fg">=</span> PipeClient<span class="ansi-blue-fg">(</span>address<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    491</span>     <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 492</span><span class="ansi-red-fg">         </span>c <span class="ansi-blue-fg">=</span> SocketClient<span class="ansi-blue-fg">(</span>address<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    493</span> 
<span class="ansi-green-intense-fg ansi-bold">    494</span>     <span class="ansi-green-fg">if</span> authkey <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span> <span class="ansi-green-fg">and</span> <span class="ansi-green-fg">not</span> isinstance<span class="ansi-blue-fg">(</span>authkey<span class="ansi-blue-fg">,</span> bytes<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/opt/conda/envs/fastrl/lib/python3.7/multiprocessing/connection.py</span> in <span class="ansi-cyan-fg">SocketClient</span><span class="ansi-blue-fg">(address)</span>
<span class="ansi-green-intense-fg ansi-bold">    618</span>     <span class="ansi-green-fg">with</span> socket<span class="ansi-blue-fg">.</span>socket<span class="ansi-blue-fg">(</span> getattr<span class="ansi-blue-fg">(</span>socket<span class="ansi-blue-fg">,</span> family<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> s<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    619</span>         s<span class="ansi-blue-fg">.</span>setblocking<span class="ansi-blue-fg">(</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 620</span><span class="ansi-red-fg">         </span>s<span class="ansi-blue-fg">.</span>connect<span class="ansi-blue-fg">(</span>address<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    621</span>         <span class="ansi-green-fg">return</span> Connection<span class="ansi-blue-fg">(</span>s<span class="ansi-blue-fg">.</span>detach<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    622</span> 

<span class="ansi-red-fg">KeyboardInterrupt</span>: </pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

