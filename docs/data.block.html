---

title: Data Block


keywords: fastai
sidebar: home_sidebar

summary: "Fastrl transforms for iterating through environments"
description: "Fastrl transforms for iterating through environments"
nb_path: "nbs/05_data.block.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/05_data.block.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">gym</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="DQN" class="doc_header"><code>class</code> <code>DQN</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L24" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DQN</code>() :: <code>Module</code></p>
</blockquote>
<p>Same as <code>nn.Module</code>, but no need for subclasses to call <code>super().__init__</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Development of this was helped by <a href="https://github.com/pytorch/pytorch/blob/4949eea0ffb60dc81a0a78402fa59fdf68206718/torch/utils/data/dataset.py#L64">IterableData documentation on multiple workers</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This code is heavily modifed from <a href="https://github.com/Shmuma/ptan">https://github.com/Shmuma/ptan</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Reference for env <a href="https://github.com/openai/universe/blob/master/doc/env_semantics.rst">semantics related to vectorized environments</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Useful links:</p>
<ul>
<li><a href="https://github.com/pytorch/pytorch/blob/a61a8d059efa0fb139a09e479b1a2c8dd1cf1a44/torch/utils/data/dataloader.py#L564">torch multiprocessing</a></li>
<li><a href="https://github.com/pytorch/pytorch/blob/master/torch/utils/data/_utils/worker.py">torch worker</a></li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="init_experience" class="doc_header"><code>init_experience</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L37" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>init_experience</code>(<strong><code>but</code></strong>=<em><code>''</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Returns dictionary with default values that can be overridden.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">init_experience</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;state&#39;: TensorBatch([[0]]),
 &#39;action&#39;: TensorBatch([[0]]),
 &#39;next_state&#39;: TensorBatch([[0]]),
 &#39;reward&#39;: TensorBatch([[0]]),
 &#39;done&#39;: TensorBatch([[False]]),
 &#39;step&#39;: TensorBatch([[0]]),
 &#39;env&#39;: TensorBatch([[0]]),
 &#39;image&#39;: TensorBatch([[0]])}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">init_experience</span><span class="p">()</span>
<span class="n">init_experience</span><span class="p">(</span><span class="n">but</span><span class="o">=</span><span class="s1">&#39;image,step&#39;</span><span class="p">)</span>
<span class="nb">sum</span><span class="p">([</span><span class="n">init_experience</span><span class="p">(),</span><span class="n">init_experience</span><span class="p">()],</span><span class="n">init_experience</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;state&#39;: TensorBatch([[0],
         [0],
         [0]]),
 &#39;action&#39;: TensorBatch([[0],
         [0],
         [0]]),
 &#39;next_state&#39;: TensorBatch([[0],
         [0],
         [0]]),
 &#39;reward&#39;: TensorBatch([[0],
         [0],
         [0]]),
 &#39;done&#39;: TensorBatch([[False],
         [False],
         [False]]),
 &#39;step&#39;: TensorBatch([[0],
         [0],
         [0]]),
 &#39;env&#39;: TensorBatch([[0],
         [0],
         [0]]),
 &#39;image&#39;: TensorBatch([[0],
         [0],
         [0]])}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cast_dtype" class="doc_header"><code>cast_dtype</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L54" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cast_dtype</code>(<strong><code>t</code></strong>, <strong><code>dtype</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FakeAgent" class="doc_header"><code>class</code> <code>FakeAgent</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L59" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FakeAgent</code>(<strong><code>action_space</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ExperienceSource" class="doc_header"><code>class</code> <code>ExperienceSource</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L65" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ExperienceSource</code>(<strong><code>env</code></strong>:<code>str</code>, <strong><code>agent</code></strong>=<em><code>None</code></em>, <strong><code>n_envs</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong><code>steps_count</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong><code>steps_delta</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong><code>seed</code></strong>:<code>int</code>=<em><code>None</code></em>, <strong><code>render</code></strong>=<em><code>None</code></em>, <strong><code>num_workers</code></strong>=<em><code>0</code></em>, <strong><code>but</code></strong>=<em><code>''</code></em>, <strong>**<code>kwargs</code></strong>) :: <code>Stateful</code></p>
</blockquote>
<p>Iterates through <code>n_envs</code> of <code>env</code> feeding experience or states into <code>agent</code>.
If <code>agent</code> is None, then random actions will be taken instead.
It will return <code>steps_count</code> experiences every <code>steps_delta</code>.
At the end of an env, it will return <code>steps_count-1</code> experiences per next.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SourceDataset" class="doc_header"><code>class</code> <code>SourceDataset</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L158" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SourceDataset</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwds</code></strong>) :: <code>IterableDataset</code></p>
</blockquote>
<p>Iterates through a <code>source</code> object. Allows for re-initing source connections when <code>num_workers&gt;0</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">train_loop</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">num_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">dataset</span><span class="o">=</span><span class="n">SourceDataset</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="n">data</span><span class="o">=</span><span class="kc">None</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span><span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">persistent_workers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wif</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">wif</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> 
<span class="c1">#             print(x)</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
                <span class="n">data</span><span class="o">=</span><span class="n">BD</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">data</span><span class="o">+</span><span class="n">BD</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>   
        <span class="k">else</span><span class="p">:</span> <span class="n">data</span><span class="o">=</span><span class="n">BD</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">data</span><span class="o">+</span><span class="n">BD</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">source</span><span class="o">=</span><span class="n">ExperienceSource</span><span class="p">(</span><span class="s1">&#39;CartPole-v1&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">steps_count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">n_envs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data</span><span class="o">=</span><span class="n">train_loop</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>action</th>
      <th>next_state</th>
      <th>reward</th>
      <th>done</th>
      <th>step</th>
      <th>env</th>
      <th>random_action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>torch.Size([150, 4])</td>
      <td>0</td>
      <td>torch.Size([150, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>torch.Size([150, 4])</td>
      <td>0</td>
      <td>torch.Size([150, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>torch.Size([150, 4])</td>
      <td>0</td>
      <td>torch.Size([150, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>3.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>torch.Size([150, 4])</td>
      <td>0</td>
      <td>torch.Size([150, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>torch.Size([150, 4])</td>
      <td>0</td>
      <td>torch.Size([150, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>3.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>torch.Size([150, 4])</td>
      <td>0</td>
      <td>torch.Size([150, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>4.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>torch.Size([150, 4])</td>
      <td>0</td>
      <td>torch.Size([150, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>3.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>torch.Size([150, 4])</td>
      <td>0</td>
      <td>torch.Size([150, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>4.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>torch.Size([150, 4])</td>
      <td>0</td>
      <td>torch.Size([150, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>5.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>9</th>
      <td>torch.Size([150, 4])</td>
      <td>0</td>
      <td>torch.Size([150, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>4.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">source</span><span class="o">=</span><span class="n">ExperienceSource</span><span class="p">(</span><span class="s1">&#39;CartPole-v1&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">steps_count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">n_envs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">data</span><span class="o">=</span><span class="n">train_loop</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>action</th>
      <th>next_state</th>
      <th>reward</th>
      <th>done</th>
      <th>step</th>
      <th>env</th>
      <th>random_action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>torch.Size([144, 4])</td>
      <td>0</td>
      <td>torch.Size([144, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>torch.Size([144, 4])</td>
      <td>0</td>
      <td>torch.Size([144, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>torch.Size([144, 4])</td>
      <td>0</td>
      <td>torch.Size([144, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>3.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>torch.Size([144, 4])</td>
      <td>0</td>
      <td>torch.Size([144, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>torch.Size([144, 4])</td>
      <td>0</td>
      <td>torch.Size([144, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>torch.Size([144, 4])</td>
      <td>0</td>
      <td>torch.Size([144, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>3.0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>torch.Size([144, 4])</td>
      <td>0</td>
      <td>torch.Size([144, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>7</th>
      <td>torch.Size([144, 4])</td>
      <td>0</td>
      <td>torch.Size([144, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>3.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>torch.Size([144, 4])</td>
      <td>0</td>
      <td>torch.Size([144, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>4.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>torch.Size([144, 4])</td>
      <td>0</td>
      <td>torch.Size([144, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">source</span><span class="o">=</span><span class="n">ExperienceSource</span><span class="p">(</span><span class="s1">&#39;CartPole-v1&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">n_envs</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">data</span><span class="o">=</span><span class="n">train_loop</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>action</th>
      <th>next_state</th>
      <th>reward</th>
      <th>done</th>
      <th>step</th>
      <th>env</th>
      <th>random_action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>1</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">source</span><span class="o">=</span><span class="n">ExperienceSource</span><span class="p">(</span><span class="s1">&#39;CartPole-v1&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">n_envs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">steps_delta</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">data</span><span class="o">=</span><span class="n">train_loop</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>action</th>
      <th>next_state</th>
      <th>reward</th>
      <th>done</th>
      <th>step</th>
      <th>env</th>
      <th>random_action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>3.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>3.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>9.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>9.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>12.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>12.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>15.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>15.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">source</span><span class="o">=</span><span class="n">ExperienceSource</span><span class="p">(</span><span class="s1">&#39;CartPole-v1&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">n_envs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data</span><span class="o">=</span><span class="n">train_loop</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>action</th>
      <th>next_state</th>
      <th>reward</th>
      <th>done</th>
      <th>step</th>
      <th>env</th>
      <th>random_action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>3.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>4.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>5.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>7.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>7</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>8.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>8</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>9.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>True</td>
      <td>10.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='I wonder if <a href="/fastrl/core.html#BD"><code>BD</code></a> would benefit from using <code>default_collate</code>?' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">source</span><span class="o">=</span><span class="n">ExperienceSource</span><span class="p">(</span><span class="s1">&#39;CartPole-v1&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">n_envs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">render</span><span class="o">=</span><span class="s1">&#39;rgb_array&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">=</span><span class="n">train_loop</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>action</th>
      <th>next_state</th>
      <th>reward</th>
      <th>done</th>
      <th>step</th>
      <th>env</th>
      <th>image</th>
      <th>random_action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>3.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>4.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>5.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>7.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>8.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>9.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>10.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>11.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>True</td>
      <td>12.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>3.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>2</td>
    </tr>
    <tr>
      <th>15</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>4.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>2</td>
    </tr>
    <tr>
      <th>16</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>5.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>7.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>8.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>2</td>
    </tr>
    <tr>
      <th>20</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>9.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>21</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>10.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>2</td>
    </tr>
    <tr>
      <th>22</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>11.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>True</td>
      <td>12.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>24</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>25</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>26</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>3.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>2</td>
    </tr>
    <tr>
      <th>27</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>4.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>5.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>2</td>
    </tr>
    <tr>
      <th>29</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>2</td>
    </tr>
    <tr>
      <th>30</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>7.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>2</td>
    </tr>
    <tr>
      <th>31</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>8.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>32</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>9.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>33</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>10.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>2</td>
    </tr>
    <tr>
      <th>34</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>11.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>35</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>12.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>36</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>13.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>37</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>14.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>38</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>15.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>39</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>16.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>2</td>
    </tr>
    <tr>
      <th>40</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>17.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>41</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>True</td>
      <td>18.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>42</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>43</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>44</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>3.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>45</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>4.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>46</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>5.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>47</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>6.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>48</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>7.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>49</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>False</td>
      <td>8.0</td>
      <td>0</td>
      <td>torch.Size([50, 1, 400, 600, 3])</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/fastrl/data.block.html#ExperienceSource"><code>ExperienceSource</code></a> is designed for iterating through <code>n_envs</code> environments.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A single experience is a <a href="/fastrl/core.html#BD"><code>BD</code></a> which is a subclass of <code>dict</code> however will batch indexing:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;state&#39;: TensorBatch([[ 0.0039, -0.0473, -0.0479,  0.0361]]),
 &#39;action&#39;: TensorBatch([[0]]),
 &#39;next_state&#39;: TensorBatch([[ 0.0029,  0.1485, -0.0472, -0.2713]]),
 &#39;reward&#39;: TensorBatch([[1.]]),
 &#39;done&#39;: TensorBatch([[False]]),
 &#39;step&#39;: TensorBatch([[1.]]),
 &#39;env&#39;: TensorBatch([[0]]),
 &#39;random_action&#39;: TensorBatch([[2]])}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>However, an agent has full power to add fields to this dict wile running</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ExperienceSource._init_state" class="doc_header"><code>ExperienceSource._init_state</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L74" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ExperienceSource._init_state</code>()</p>
</blockquote>
<p>Inits the histories, experiences, and the environment pool when sent to a <code>Process</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ExperienceSource.__iter__" class="doc_header"><code>ExperienceSource.__iter__</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L97" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ExperienceSource.__iter__</code>()</p>
</blockquote>
<p>Iterates through a list of environments.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If the <code>self.pool</code> field is empty, it will call <code>_init_state</code> to reinitialize everything.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FirstLastExperienceSource" class="doc_header"><code>class</code> <code>FirstLastExperienceSource</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L165" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FirstLastExperienceSource</code>(<strong><code>env</code></strong>:<code>str</code>, <strong><code>agent</code></strong>=<em><code>None</code></em>, <strong><code>n_envs</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong><code>steps_count</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong><code>steps_delta</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong><code>seed</code></strong>:<code>int</code>=<em><code>None</code></em>, <strong><code>render</code></strong>=<em><code>None</code></em>, <strong><code>num_workers</code></strong>=<em><code>0</code></em>, <strong><code>but</code></strong>=<em><code>''</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/fastrl/data.block.html#ExperienceSource"><code>ExperienceSource</code></a></p>
</blockquote>
<p>Iterates through <code>n_envs</code> of <code>env</code> feeding experience or states into <code>agent</code>.
If <code>agent</code> is None, then random actions will be taken instead.
It will return <code>steps_count</code> experiences every <code>steps_delta</code>.
At the end of an env, it will return <code>steps_count-1</code> experiences per next.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">source</span><span class="o">=</span><span class="n">FirstLastExperienceSource</span><span class="p">(</span><span class="s1">&#39;CartPole-v1&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">steps_count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">steps_delta</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">n_envs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">data</span><span class="o">=</span><span class="n">train_loop</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">num_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>action</th>
      <th>next_state</th>
      <th>reward</th>
      <th>done</th>
      <th>step</th>
      <th>env</th>
      <th>random_action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>2.9701</td>
      <td>False</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>2.9701</td>
      <td>False</td>
      <td>2.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>2.9701</td>
      <td>False</td>
      <td>2.0</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>2.9701</td>
      <td>False</td>
      <td>2.0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>2.9701</td>
      <td>False</td>
      <td>4.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>2.9701</td>
      <td>False</td>
      <td>4.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>2.9701</td>
      <td>False</td>
      <td>4.0</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>7</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>2.9701</td>
      <td>False</td>
      <td>4.0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>2.9701</td>
      <td>False</td>
      <td>6.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>torch.Size([50, 4])</td>
      <td>0</td>
      <td>torch.Size([50, 4])</td>
      <td>2.9701</td>
      <td>False</td>
      <td>6.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Fastai-integration">Fastai integration<a class="anchor-link" href="#Fastai-integration"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai.test_utils</span> <span class="kn">import</span> <span class="n">synth_learner</span>
<span class="kn">from</span> <span class="nn">fastrl.data.block</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">IterableTfmdLists</span><span class="p">(</span><span class="n">TfmdLists</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_after_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tfms</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">IterableDataBlock</span><span class="p">(</span><span class="n">DataBlock</span><span class="p">):</span>
    <span class="nd">@delegates</span><span class="p">(</span><span class="n">DataBlock</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tl_type</span><span class="o">=</span><span class="n">IterableTfmdLists</span>
        
    <span class="k">def</span> <span class="nf">datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>                     <span class="p">;</span> <span class="n">pv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Collecting items from </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_items</span> <span class="ow">or</span> <span class="n">noop</span><span class="p">)(</span><span class="n">source</span><span class="p">)</span> <span class="p">;</span> <span class="n">pv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="si">}</span><span class="s2"> items&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
        <span class="n">splits</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="ow">or</span> <span class="n">RandomSplitter</span><span class="p">())(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">pv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">splits</span><span class="p">)</span><span class="si">}</span><span class="s2"> datasets of sizes </span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">splits</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Datasets</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">tfms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_combine_type_tfms</span><span class="p">(),</span> <span class="n">splits</span><span class="o">=</span><span class="n">splits</span><span class="p">,</span> <span class="n">dl_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dl_type</span><span class="p">,</span> <span class="n">n_inp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_inp</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                        <span class="n">tl_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tl_type</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@patch</span>
<span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span><span class="n">Datasets</span><span class="p">):</span>
<span class="c1">#     print(&#39;itering&#39;,self[0])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="nd">@patch</span>
<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span><span class="n">Datasets</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tfms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_inp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dl_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tl_type</span><span class="o">=</span><span class="n">TfmdLists</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Datasets</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">dl_type</span><span class="o">=</span><span class="n">dl_type</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tls</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="n">tls</span> <span class="k">if</span> <span class="n">tls</span> <span class="k">else</span> <span class="p">[</span><span class="n">tl_type</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">L</span><span class="p">(</span><span class="n">ifnone</span><span class="p">(</span><span class="n">tfms</span><span class="p">,[</span><span class="kc">None</span><span class="p">]))])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_inp</span> <span class="o">=</span> <span class="n">ifnone</span><span class="p">(</span><span class="n">n_inp</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tls</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dqn</span><span class="o">=</span><span class="n">DQN</span><span class="p">()</span><span class="o">.</span><span class="n">share_memory</span><span class="p">()</span>
<span class="n">opt</span><span class="o">=</span><span class="n">Adam</span><span class="p">(</span><span class="n">dqn</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span><span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

<span class="n">source</span><span class="o">=</span><span class="n">ExperienceSource</span><span class="p">(</span><span class="s1">&#39;CartPole-v1&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">steps_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n_envs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># dataset=SourceDataset(source)</span>
<span class="n">gym_block</span><span class="o">=</span><span class="n">IterableDataBlock</span><span class="p">(</span>
    <span class="n">splitter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:[[</span><span class="mi">0</span><span class="p">]],</span>
<span class="p">)</span>

<span class="n">dls</span><span class="o">=</span><span class="n">gym_block</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">([</span><span class="nb">iter</span><span class="p">(</span><span class="n">source</span><span class="p">)],</span><span class="n">n</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">bs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">indexed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">wif</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">_init_state</span><span class="p">(),</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dls</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="k">pass</span>
<span class="c1">#     print(x)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Collecting items from [&lt;generator object ExperienceSource.__iter__ at 0x7fb05015d550&gt;]
Found 1 items
1 datasets of sizes 1
Setting up Pipeline: 
Setting up Pipeline: 
Setting up after_item: Pipeline: ToTensor
Setting up before_batch: Pipeline: 
Setting up after_batch: Pipeline: 
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">=</span><span class="n">Learner</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">dqn</span><span class="p">,</span><span class="n">dls</span><span class="o">=</span><span class="n">dls</span><span class="p">,</span><span class="n">loss_func</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

