---

title: Data Block


keywords: fastai
sidebar: home_sidebar

summary: "Fastrl transforms for iterating through environments"
description: "Fastrl transforms for iterating through environments"
nb_path: "nbs/05_data.block.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/05_data.block.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">gym</span>
<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span><span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">torch.multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="DQN" class="doc_header"><code>class</code> <code>DQN</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L26" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DQN</code>() :: <code>Module</code></p>
</blockquote>
<p>Same as <code>nn.Module</code>, but no need for subclasses to call <code>super().__init__</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Development of this was helped by <a href="https://github.com/pytorch/pytorch/blob/4949eea0ffb60dc81a0a78402fa59fdf68206718/torch/utils/data/dataset.py#L64">IterableData documentation on multiple workers</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This code is heavily modifed from <a href="https://github.com/Shmuma/ptan">https://github.com/Shmuma/ptan</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Reference for env <a href="https://github.com/openai/universe/blob/master/doc/env_semantics.rst">semantics related to vectorized environments</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Useful links:</p>
<ul>
<li><a href="https://github.com/pytorch/pytorch/blob/a61a8d059efa0fb139a09e479b1a2c8dd1cf1a44/torch/utils/data/dataloader.py#L564">torch multiprocessing</a></li>
<li><a href="https://github.com/pytorch/pytorch/blob/master/torch/utils/data/_utils/worker.py">torch worker</a></li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="o2tensor_batch" class="doc_header"><code>o2tensor_batch</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L121" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>o2tensor_batch</code>(<strong><code>o</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="init_experience" class="doc_header"><code>init_experience</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L126" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>init_experience</code>(<strong><code>but</code></strong>=<em><code>''</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Returns dictionary with default values that can be overridden.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">init_experience</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;state&#39;: tensor([[0.]]),
 &#39;action&#39;: tensor([[0.]]),
 &#39;next_state&#39;: tensor([[0.]]),
 &#39;reward&#39;: tensor([[0.]]),
 &#39;done&#39;: tensor([[0.]]),
 &#39;step&#39;: tensor([[0.]]),
 &#39;env&#39;: tensor([[0.]]),
 &#39;image&#39;: tensor([[0.]])}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">init_experience</span><span class="p">(</span><span class="n">but</span><span class="o">=</span><span class="s1">&#39;image,step&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;state&#39;: tensor([[0.]]),
 &#39;action&#39;: tensor([[0.]]),
 &#39;next_state&#39;: tensor([[0.]]),
 &#39;reward&#39;: tensor([[0.]]),
 &#39;done&#39;: tensor([[0.]]),
 &#39;env&#39;: tensor([[0.]])}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">sum</span><span class="p">([</span><span class="n">init_experience</span><span class="p">(),</span><span class="n">init_experience</span><span class="p">()],</span><span class="n">init_experience</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;state&#39;: tensor([[0.],
         [0.],
         [0.]]),
 &#39;action&#39;: tensor([[0.],
         [0.],
         [0.]]),
 &#39;next_state&#39;: tensor([[0.],
         [0.],
         [0.]]),
 &#39;reward&#39;: tensor([[0.],
         [0.],
         [0.]]),
 &#39;done&#39;: tensor([[0.],
         [0.],
         [0.]]),
 &#39;step&#39;: tensor([[0.],
         [0.],
         [0.]]),
 &#39;env&#39;: tensor([[0.],
         [0.],
         [0.]]),
 &#39;image&#39;: tensor([[0.],
         [0.],
         [0.]])}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cast_dtype" class="doc_header"><code>cast_dtype</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L143" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cast_dtype</code>(<strong><code>t</code></strong>, <strong><code>dtype</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FakeAgent" class="doc_header"><code>class</code> <code>FakeAgent</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L148" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FakeAgent</code>(<strong><code>action_space</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ExperienceSource" class="doc_header"><code>class</code> <code>ExperienceSource</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L154" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ExperienceSource</code>(<strong><code>env</code></strong>:<code>str</code>, <strong><code>agent</code></strong>=<em><code>None</code></em>, <strong><code>n_envs</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong><code>steps_count</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong><code>steps_delta</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong><code>seed</code></strong>:<code>int</code>=<em><code>None</code></em>, <strong><code>render</code></strong>=<em><code>None</code></em>, <strong><code>num_workers</code></strong>=<em><code>0</code></em>, <strong><code>but</code></strong>=<em><code>''</code></em>, <strong>**<code>kwargs</code></strong>) :: <code>Stateful</code></p>
</blockquote>
<p>Iterates through <code>n_envs</code> of <code>env</code> feeding experience or states into <code>agent</code>.
If <code>agent</code> is None, then random actions will be taken instead.
It will return <code>steps_count</code> experiences every <code>steps_delta</code>.
At the end of an env, it will return <code>steps_count-1</code> experiences per next.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SourceDataset" class="doc_header"><code>class</code> <code>SourceDataset</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L246" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SourceDataset</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwds</code></strong>) :: <code>IterableDataset</code></p>
</blockquote>
<p>Iterates through a <code>source</code> object. Allows for re-initing source connections when <code>num_workers&gt;0</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">source</span><span class="o">=</span><span class="n">ExperienceSource</span><span class="p">(</span><span class="s1">&#39;CartPole-v1&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">n_envs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dataset</span><span class="o">=</span><span class="n">SourceDataset</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

<span class="n">data</span><span class="o">=</span><span class="kc">None</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span><span class="n">num_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">persistent_workers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wif</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">wif</span><span class="p">):</span>
    <span class="n">data</span><span class="o">=</span><span class="n">BD</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">data</span><span class="o">+</span><span class="n">BD</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>action</th>
      <th>next_state</th>
      <th>reward</th>
      <th>done</th>
      <th>step</th>
      <th>env</th>
      <th>random_action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>7</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>9</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>10</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>6.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>11</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>6.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>7.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>13</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>7.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>14</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>8.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>15</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>8.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>16</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>9.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>17</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>9.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>18</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>19</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>11.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>21</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>11.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>22</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>12.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>25</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>13.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>26</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>27</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>29</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>15.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>30</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>31</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>16.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>32</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>6.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>33</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>17.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>34</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>7.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>35</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>18.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>36</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>8.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>37</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>19.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>38</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>9.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>39</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>20.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>40</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>41</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>21.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>42</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>11.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>43</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>22.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>44</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>12.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>45</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>23.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>46</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>13.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>47</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>24.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>48</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>14.0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>49</th>
      <td>torch.Size([50, 4])</td>
      <td>0.0</td>
      <td>torch.Size([50, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='I wonder if <a href="/fastrl/core.html#BD"><code>BD</code></a> would benefit from using <code>default_collate</code>?' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>default_collate<span class="o">??</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea ">
<pre><span class="ansi-red-fg">Signature:</span> default_collate<span class="ansi-blue-fg">(</span>batch<span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">Source:</span>   
<span class="ansi-green-fg">def</span> default_collate<span class="ansi-blue-fg">(</span>batch<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
    <span class="ansi-blue-fg">r&#34;&#34;&#34;Puts each data field into a tensor with outer dimension batch size&#34;&#34;&#34;</span>

    elem <span class="ansi-blue-fg">=</span> batch<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span>
    elem_type <span class="ansi-blue-fg">=</span> type<span class="ansi-blue-fg">(</span>elem<span class="ansi-blue-fg">)</span>
    <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>elem<span class="ansi-blue-fg">,</span> torch<span class="ansi-blue-fg">.</span>Tensor<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
        out <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">None</span>
        <span class="ansi-green-fg">if</span> torch<span class="ansi-blue-fg">.</span>utils<span class="ansi-blue-fg">.</span>data<span class="ansi-blue-fg">.</span>get_worker_info<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
            <span class="ansi-red-fg"># If we&#39;re in a background process, concatenate directly into a</span>
            <span class="ansi-red-fg"># shared memory tensor to avoid an extra copy</span>
            numel <span class="ansi-blue-fg">=</span> sum<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>x<span class="ansi-blue-fg">.</span>numel<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> x <span class="ansi-green-fg">in</span> batch<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
            storage <span class="ansi-blue-fg">=</span> elem<span class="ansi-blue-fg">.</span>storage<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>_new_shared<span class="ansi-blue-fg">(</span>numel<span class="ansi-blue-fg">)</span>
            out <span class="ansi-blue-fg">=</span> elem<span class="ansi-blue-fg">.</span>new<span class="ansi-blue-fg">(</span>storage<span class="ansi-blue-fg">)</span>
        <span class="ansi-green-fg">return</span> torch<span class="ansi-blue-fg">.</span>stack<span class="ansi-blue-fg">(</span>batch<span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span> out<span class="ansi-blue-fg">=</span>out<span class="ansi-blue-fg">)</span>
    <span class="ansi-green-fg">elif</span> elem_type<span class="ansi-blue-fg">.</span>__module__ <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">&#39;numpy&#39;</span> <span class="ansi-green-fg">and</span> elem_type<span class="ansi-blue-fg">.</span>__name__ <span class="ansi-blue-fg">!=</span> <span class="ansi-blue-fg">&#39;str_&#39;</span> \
            <span class="ansi-green-fg">and</span> elem_type<span class="ansi-blue-fg">.</span>__name__ <span class="ansi-blue-fg">!=</span> <span class="ansi-blue-fg">&#39;string_&#39;</span><span class="ansi-blue-fg">:</span>
        <span class="ansi-green-fg">if</span> elem_type<span class="ansi-blue-fg">.</span>__name__ <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">&#39;ndarray&#39;</span> <span class="ansi-green-fg">or</span> elem_type<span class="ansi-blue-fg">.</span>__name__ <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">&#39;memmap&#39;</span><span class="ansi-blue-fg">:</span>
            <span class="ansi-red-fg"># array of string classes and object</span>
            <span class="ansi-green-fg">if</span> np_str_obj_array_pattern<span class="ansi-blue-fg">.</span>search<span class="ansi-blue-fg">(</span>elem<span class="ansi-blue-fg">.</span>dtype<span class="ansi-blue-fg">.</span>str<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
                <span class="ansi-green-fg">raise</span> TypeError<span class="ansi-blue-fg">(</span>default_collate_err_msg_format<span class="ansi-blue-fg">.</span>format<span class="ansi-blue-fg">(</span>elem<span class="ansi-blue-fg">.</span>dtype<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

            <span class="ansi-green-fg">return</span> default_collate<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>torch<span class="ansi-blue-fg">.</span>as_tensor<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> b <span class="ansi-green-fg">in</span> batch<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
        <span class="ansi-green-fg">elif</span> elem<span class="ansi-blue-fg">.</span>shape <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>  <span class="ansi-red-fg"># scalars</span>
            <span class="ansi-green-fg">return</span> torch<span class="ansi-blue-fg">.</span>as_tensor<span class="ansi-blue-fg">(</span>batch<span class="ansi-blue-fg">)</span>
    <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>elem<span class="ansi-blue-fg">,</span> float<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
        <span class="ansi-green-fg">return</span> torch<span class="ansi-blue-fg">.</span>tensor<span class="ansi-blue-fg">(</span>batch<span class="ansi-blue-fg">,</span> dtype<span class="ansi-blue-fg">=</span>torch<span class="ansi-blue-fg">.</span>float64<span class="ansi-blue-fg">)</span>
    <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>elem<span class="ansi-blue-fg">,</span> int_classes<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
        <span class="ansi-green-fg">return</span> torch<span class="ansi-blue-fg">.</span>tensor<span class="ansi-blue-fg">(</span>batch<span class="ansi-blue-fg">)</span>
    <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>elem<span class="ansi-blue-fg">,</span> string_classes<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
        <span class="ansi-green-fg">return</span> batch
    <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>elem<span class="ansi-blue-fg">,</span> container_abcs<span class="ansi-blue-fg">.</span>Mapping<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
        <span class="ansi-green-fg">return</span> <span class="ansi-blue-fg">{</span>key<span class="ansi-blue-fg">:</span> default_collate<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>d<span class="ansi-blue-fg">[</span>key<span class="ansi-blue-fg">]</span> <span class="ansi-green-fg">for</span> d <span class="ansi-green-fg">in</span> batch<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> key <span class="ansi-green-fg">in</span> elem<span class="ansi-blue-fg">}</span>
    <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>elem<span class="ansi-blue-fg">,</span> tuple<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">and</span> hasattr<span class="ansi-blue-fg">(</span>elem<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;_fields&#39;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>  <span class="ansi-red-fg"># namedtuple</span>
        <span class="ansi-green-fg">return</span> elem_type<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span><span class="ansi-blue-fg">(</span>default_collate<span class="ansi-blue-fg">(</span>samples<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> samples <span class="ansi-green-fg">in</span> zip<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>batch<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
    <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>elem<span class="ansi-blue-fg">,</span> container_abcs<span class="ansi-blue-fg">.</span>Sequence<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
        <span class="ansi-red-fg"># check to make sure that the elements in batch have consistent size</span>
        it <span class="ansi-blue-fg">=</span> iter<span class="ansi-blue-fg">(</span>batch<span class="ansi-blue-fg">)</span>
        elem_size <span class="ansi-blue-fg">=</span> len<span class="ansi-blue-fg">(</span>next<span class="ansi-blue-fg">(</span>it<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
        <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> all<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">(</span>elem<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">==</span> elem_size <span class="ansi-green-fg">for</span> elem <span class="ansi-green-fg">in</span> it<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
            <span class="ansi-green-fg">raise</span> RuntimeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;each element in list of batch should be of equal size&#39;</span><span class="ansi-blue-fg">)</span>
        transposed <span class="ansi-blue-fg">=</span> zip<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>batch<span class="ansi-blue-fg">)</span>
        <span class="ansi-green-fg">return</span> <span class="ansi-blue-fg">[</span>default_collate<span class="ansi-blue-fg">(</span>samples<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> samples <span class="ansi-green-fg">in</span> transposed<span class="ansi-blue-fg">]</span>

    <span class="ansi-green-fg">raise</span> TypeError<span class="ansi-blue-fg">(</span>default_collate_err_msg_format<span class="ansi-blue-fg">.</span>format<span class="ansi-blue-fg">(</span>elem_type<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">File:</span>      /opt/conda/lib/python3.7/site-packages/torch/utils/data/_utils/collate.py
<span class="ansi-red-fg">Type:</span>      function
</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">source</span><span class="o">=</span><span class="n">ExperienceSource</span><span class="p">(</span><span class="s1">&#39;CartPole-v1&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">n_envs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">render</span><span class="o">=</span><span class="s1">&#39;rgb_array&#39;</span><span class="p">)</span>
<span class="n">dataset</span><span class="o">=</span><span class="n">SourceDataset</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

<span class="n">data</span><span class="o">=</span><span class="kc">None</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span><span class="n">num_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">persistent_workers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wif</span><span class="o">=</span><span class="n">dataset</span><span class="o">.</span><span class="n">wif</span><span class="p">):</span>
    <span class="n">data</span><span class="o">=</span><span class="n">BD</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">data</span><span class="o">+</span><span class="n">BD</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>action</th>
      <th>next_state</th>
      <th>reward</th>
      <th>done</th>
      <th>step</th>
      <th>env</th>
      <th>image</th>
      <th>random_action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>torch.Size([10, 4])</td>
      <td>0.0</td>
      <td>torch.Size([10, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>torch.Size([10, 400, 600, 3])</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>torch.Size([10, 4])</td>
      <td>0.0</td>
      <td>torch.Size([10, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>torch.Size([10, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>torch.Size([10, 4])</td>
      <td>0.0</td>
      <td>torch.Size([10, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>torch.Size([10, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>torch.Size([10, 4])</td>
      <td>0.0</td>
      <td>torch.Size([10, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>torch.Size([10, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>torch.Size([10, 4])</td>
      <td>0.0</td>
      <td>torch.Size([10, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>torch.Size([10, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>torch.Size([10, 4])</td>
      <td>0.0</td>
      <td>torch.Size([10, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0</td>
      <td>torch.Size([10, 400, 600, 3])</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>torch.Size([10, 4])</td>
      <td>0.0</td>
      <td>torch.Size([10, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>torch.Size([10, 400, 600, 3])</td>
      <td>2</td>
    </tr>
    <tr>
      <th>7</th>
      <td>torch.Size([10, 4])</td>
      <td>0.0</td>
      <td>torch.Size([10, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0</td>
      <td>torch.Size([10, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>torch.Size([10, 4])</td>
      <td>0.0</td>
      <td>torch.Size([10, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0</td>
      <td>torch.Size([10, 400, 600, 3])</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>torch.Size([10, 4])</td>
      <td>0.0</td>
      <td>torch.Size([10, 4])</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0</td>
      <td>torch.Size([10, 400, 600, 3])</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/fastrl/data.block.html#ExperienceSource"><code>ExperienceSource</code></a> is designed for iterating through <code>n_envs</code> environments.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A single experience is a <a href="/fastrl/core.html#BD"><code>BD</code></a> which is a subclass of <code>dict</code> however will batch indexing:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;state&#39;: tensor([[-0.0213, -0.0315, -0.0271,  0.0376]]),
 &#39;action&#39;: tensor([[0.]]),
 &#39;next_state&#39;: tensor([[-0.0220,  0.1640, -0.0263, -0.2635]]),
 &#39;reward&#39;: tensor([[1.]]),
 &#39;done&#39;: tensor([[0.]]),
 &#39;step&#39;: tensor([[1.]]),
 &#39;env&#39;: tensor([[0]]),
 &#39;random_action&#39;: tensor([[2]])}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>However, an agent has full power to add fields to this dict wile running</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ExperienceSource._init_state" class="doc_header"><code>ExperienceSource._init_state</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L163" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ExperienceSource._init_state</code>()</p>
</blockquote>
<p>Inits the histories, experiences, and the environment pool when sent to a <code>Process</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ExperienceSource.__iter__" class="doc_header"><code>ExperienceSource.__iter__</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/data/block.py#L186" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ExperienceSource.__iter__</code>()</p>
</blockquote>
<p>Iterates through a list of environments.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If the <code>self.pool</code> field is empty, it will call <code>_init_state</code> to reinitialize everything.</p>

</div>
</div>
</div>
</div>
 

