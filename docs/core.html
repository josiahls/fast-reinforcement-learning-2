---

title: Core


keywords: fastai
sidebar: home_sidebar

summary: "Core libs for fastrl"
description: "Core libs for fastrl"
nb_path: "nbs/00_core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/00_core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="D">D<a class="anchor-link" href="#D"> </a></h2><blockquote><p>A better dictionary</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="isnone" class="doc_header"><code>isnone</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/core.py#L19" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>isnone</code>(<strong><code>v</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="map_dict_ex" class="doc_header"><code>map_dict_ex</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/core.py#L22" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>map_dict_ex</code>(<strong><code>d</code></strong>, <strong><code>f</code></strong>, <strong>*<code>args</code></strong>, <strong><code>gen</code></strong>=<em><code>False</code></em>, <strong><code>wise</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Like <code>map</code>, but for dicts and uses <code>bind</code>, and supports <code>str</code> and indexing</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check that general mapping for dicts works nicely...</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">map_dict_ex</span><span class="p">(</span><span class="n">test_dict</span><span class="p">,</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_new&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))),{</span><span class="s1">&#39;a_new&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;b_new&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;c_new&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check that key and value wise mapping works correctly...</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">map_dict_ex</span><span class="p">(</span><span class="n">test_dict</span><span class="p">,</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;_new&#39;</span><span class="p">,</span><span class="n">wise</span><span class="o">=</span><span class="s1">&#39;key&#39;</span><span class="p">)),{</span><span class="s1">&#39;a_new&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;b_new&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;c_new&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">map_dict_ex</span><span class="p">(</span><span class="n">test_dict</span><span class="p">,</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">wise</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)),{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="D" class="doc_header"><code>class</code> <code>D</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/core.py#L34" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>D</code>(<strong>*<code>args</code></strong>, <strong><code>mapping</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>) :: <code>dict</code></p>
</blockquote>
<p>Improved version of <code>dict</code> with array handling abilities</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_dict</span><span class="o">=</span><span class="n">D</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">test_dict</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_new&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)),{</span><span class="s1">&#39;a_new&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;b_new&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;c_new&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">test_dict</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_new&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">gen</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="nb">map</span><span class="p">),</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">test_dict</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_new&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">gen</span><span class="o">=</span><span class="kc">True</span><span class="p">)),{</span><span class="s1">&#39;a_new&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;b_new&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;c_new&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">test_dict</span><span class="o">.</span><span class="n">mapk</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;_new&#39;</span><span class="p">),{</span><span class="s1">&#39;a_new&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;b_new&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;c_new&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">test_dict</span><span class="o">.</span><span class="n">mapk</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;_new&#39;</span><span class="p">,</span><span class="n">gen</span><span class="o">=</span><span class="kc">True</span><span class="p">)),{</span><span class="s1">&#39;a_new&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;b_new&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;c_new&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">test_dict</span><span class="o">.</span><span class="n">mapv</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">wise</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">),{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">test_dict</span><span class="o">.</span><span class="n">mapv</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">gen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wise</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)),{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/fastrl/core.html#BD"><code>BD</code></a> is the primary data structure that <code>fastrl</code> uses. It allows for easily iterating and doing operations on steps attained from environments.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="BD">BD<a class="anchor-link" href="#BD"> </a></h2><blockquote><p>A batch wise dictionary that requires all values to be numpy,tensor, or None.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Utilities">Utilities<a class="anchor-link" href="#Utilities"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Stacking-API">Stacking API<a class="anchor-link" href="#Stacking-API"> </a></h4><blockquote><p>We use the fastcore typedispatch decortors to select the currect method of stacking arrays.</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Exceptions">Exceptions<a class="anchor-link" href="#Exceptions"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BDTypeError" class="doc_header"><code>class</code> <code>BDTypeError</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/core.py#L60" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BDTypeError</code>(<strong><code>k</code></strong>, <strong><code>v</code></strong>) :: <code>Exception</code></p>
</blockquote>
<p>Common base class for all non-exit exceptions.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BDBatchSizeError" class="doc_header"><code>class</code> <code>BDBatchSizeError</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/core.py#L72" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BDBatchSizeError</code>(<strong><code>k</code></strong>, <strong><code>v</code></strong>, <strong><code>bs</code></strong>) :: <code>Exception</code></p>
</blockquote>
<p>Common base class for all non-exit exceptions.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BDKeyMisMatchError" class="doc_header"><code>class</code> <code>BDKeyMisMatchError</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/core.py#L81" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BDKeyMisMatchError</code>(<strong><code>different</code></strong>) :: <code>Exception</code></p>
</blockquote>
<p>Common base class for all non-exit exceptions.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Correction-Functions">Correction Functions<a class="anchor-link" href="#Correction-Functions"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="list2tensor" class="doc_header"><code>list2tensor</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/core.py#L91" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>list2tensor</code>(<strong><code>l</code></strong>:<code>ndarray'&gt;)</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="tensor2shape" class="doc_header"><code>tensor2shape</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/core.py#L96" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>tensor2shape</code>(<strong><code>k</code></strong>, <strong><code>t</code></strong>:<code>Tensor</code>, <strong><code>bs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="tensor2mu" class="doc_header"><code>tensor2mu</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/core.py#L101" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>tensor2mu</code>(<strong><code>k</code></strong>, <strong><code>t</code></strong>:<code>Tensor</code>, <strong><code>bs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BD" class="doc_header"><code>class</code> <code>BD</code><a href="https://github.com/josiahls/fastrl/tree/master/fastrl/core.py#L104" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BD</code>(<strong>*<code>args</code></strong>, <strong><code>bd_batch_size</code></strong>=<em><code>1</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/fastrl/core.html#D"><code>D</code></a></p>
</blockquote>
<p>Improved version of <code>dict</code> with array handling abilities</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We need to change any indexer that is passed. We don't know if the indexer is going to
be a numpy array, slice, tensor, or int.
All we know is 2 things:</p>
<ul>
<li>If it is an int, the batch dim will disappear</li>
<li>If it is an indexer, then the batch dim will stay, but be smaller</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">step_f</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;state&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,),</span><span class="s1">&#39;next_state&#39;</span><span class="p">:</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,),</span>
                <span class="s1">&#39;action&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;reward&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">ranf</span><span class="p">(),</span>
                <span class="s1">&#39;steps&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="s1">&#39;episode_reward&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">40</span><span class="p">),</span>
                <span class="s1">&#39;env&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">40</span><span class="p">),</span><span class="s1">&#39;done&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">}</span>
<span class="n">test_fail</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span><span class="n">BD</span><span class="p">(</span><span class="n">step_f</span><span class="p">()))</span>
<span class="n">step_f</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;state&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,),</span><span class="s1">&#39;next_state&#39;</span><span class="p">:</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,),</span>
                <span class="s1">&#39;action&#39;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)],</span><span class="s1">&#39;reward&#39;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">ranf</span><span class="p">()],</span>
                <span class="s1">&#39;steps&#39;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">)],</span><span class="s1">&#39;episode_reward&#39;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">40</span><span class="p">)],</span>
                <span class="s1">&#39;env&#39;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">40</span><span class="p">)],</span><span class="s1">&#39;done&#39;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">],</span>
                <span class="s1">&#39;image&#39;</span><span class="p">:</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)}</span>

<span class="n">test_d</span><span class="o">=</span><span class="nb">sum</span><span class="p">((</span><span class="n">BD</span><span class="p">(</span><span class="n">step_f</span><span class="p">())</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">19</span><span class="p">)),</span><span class="n">BD</span><span class="p">(</span><span class="n">step_f</span><span class="p">()))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">test_d</span><span class="o">.</span><span class="n">bd_batch_size</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check that indexing works as well as the adjusting of the batch size...</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">test_d</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]),</span><span class="n">Tensor</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">test_d</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span><span class="n">BD</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">test_d</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">bd_batch_size</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_d</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>next_state</th>
      <th>action</th>
      <th>reward</th>
      <th>steps</th>
      <th>episode_reward</th>
      <th>env</th>
      <th>done</th>
      <th>image</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>1</td>
      <td>0.184751</td>
      <td>11</td>
      <td>23</td>
      <td>31</td>
      <td>False</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>1</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>0</td>
      <td>0.047794</td>
      <td>17</td>
      <td>38</td>
      <td>5</td>
      <td>False</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>2</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>0</td>
      <td>0.651425</td>
      <td>15</td>
      <td>19</td>
      <td>25</td>
      <td>True</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>3</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>0</td>
      <td>0.212059</td>
      <td>8</td>
      <td>18</td>
      <td>22</td>
      <td>False</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>4</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>0</td>
      <td>0.195875</td>
      <td>9</td>
      <td>20</td>
      <td>14</td>
      <td>True</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>5</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>0</td>
      <td>0.109322</td>
      <td>8</td>
      <td>11</td>
      <td>13</td>
      <td>True</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>6</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>0</td>
      <td>0.676784</td>
      <td>10</td>
      <td>5</td>
      <td>16</td>
      <td>True</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>7</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>0</td>
      <td>0.116126</td>
      <td>18</td>
      <td>34</td>
      <td>10</td>
      <td>True</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>8</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>0</td>
      <td>0.729368</td>
      <td>19</td>
      <td>10</td>
      <td>38</td>
      <td>False</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>9</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>1</td>
      <td>0.237299</td>
      <td>11</td>
      <td>22</td>
      <td>8</td>
      <td>False</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>10</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>0</td>
      <td>0.756411</td>
      <td>5</td>
      <td>7</td>
      <td>5</td>
      <td>False</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>11</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>1</td>
      <td>0.256119</td>
      <td>12</td>
      <td>20</td>
      <td>16</td>
      <td>True</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>12</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>0</td>
      <td>0.901421</td>
      <td>9</td>
      <td>17</td>
      <td>35</td>
      <td>True</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>13</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>1</td>
      <td>0.059873</td>
      <td>1</td>
      <td>14</td>
      <td>16</td>
      <td>False</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>14</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>0</td>
      <td>0.227755</td>
      <td>13</td>
      <td>30</td>
      <td>32</td>
      <td>False</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>15</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>0</td>
      <td>0.770094</td>
      <td>10</td>
      <td>10</td>
      <td>8</td>
      <td>False</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>16</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>1</td>
      <td>0.318472</td>
      <td>16</td>
      <td>28</td>
      <td>35</td>
      <td>False</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>17</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>1</td>
      <td>0.028804</td>
      <td>13</td>
      <td>18</td>
      <td>16</td>
      <td>False</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>18</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>1</td>
      <td>0.287411</td>
      <td>7</td>
      <td>29</td>
      <td>11</td>
      <td>True</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
    <tr>
      <th>19</th>
      <td>torch.Size([20, 4])</td>
      <td>torch.Size([20, 4])</td>
      <td>1</td>
      <td>0.060582</td>
      <td>10</td>
      <td>5</td>
      <td>38</td>
      <td>False</td>
      <td>torch.Size([20, 5, 5, 3])</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">BD</span><span class="p">(</span><span class="n">test_d</span><span class="p">)[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,(</span><span class="mi">20</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

